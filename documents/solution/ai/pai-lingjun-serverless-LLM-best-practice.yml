ROSTemplateFormatVersion: '2015-09-01'
Description:
  zh-cn: 创建VPC、交换机、安全组、OSS桶，PAI、灵骏、NAS资源需手动添。
  en: Creation of VPCs, switches, security groups, OSS buckets, PAI, Lingju, and NAS
    resources requires manual addition.
Parameters:
  ZoneId:
    Type: String
    Label:
      en: Zone ID.
      zh-cn: 可用区ID。
    Description:
      en: Zone ID.
      zh-cn: 可用区ID。
    AssociationProperty: ZoneId
  BucketName:
    Type: String
    Label:
      en: OSS bucket name.
      zh-cn: OSS bucket名字。
    Description:
      en: custom OSS bucket name. Default:bucket-llm.
      zh-cn: 自定义对象存储桶的名称。 默认为bucket-llm
    Default: bucket-llm
Resources:
  ModuleVpcAndVswitch:
    Type: MODULE::ACS::VPC::OptionalVpcAndVSwitch
    Properties:
      ZoneId:
        Ref: ZoneId
    Version: default
  SecurityGroup:
    Type: ALIYUN::ECS::SecurityGroup
    Properties:
      VpcId:
        Fn::GetAtt:
        - ModuleVpcAndVswitch
        - VpcId
      SecurityGroupIngress:
      - Priority: 1
        PortRange: 80/80
        NicType: internet
        SourceCidrIp: 0.0.0.0/0
        IpProtocol: tcp
      - Priority: 1
        PortRange: 443/443
        NicType: internet
        SourceCidrIp: 0.0.0.0/0
        IpProtocol: tcp
  OssBucket:
    Type: ALIYUN::OSS::Bucket
    Properties:
      BucketName:
        Ref: BucketName
Outputs:
  VpcId:
    Description:
      en: The ID of VPC.
      zh-cn: 专有网络ID。
    Value:
      Fn::GetAtt:
      - ModuleVpcAndVswitch
      - VpcId
  VSwitchId:
    Description:
      en: The ID of VSwitch.
      zh-cn: 交换机ID。
    Value:
      Fn::GetAtt:
      - ModuleVpcAndVswitch
      - VSwitchId
  OSSBucketName:
    Description:
      en: The name of OSS bucket.
      zh-cn: OSS桶名称。
    Value:
      Fn::GetAtt:
      - OssBucket
      - Name
Metadata:
  ALIYUN::ROS::Interface:
    ParameterGroups:
    - Parameters:
      - ZoneId
      - BucketName
    TemplateTags:
    - acs:technical-solution:ai:PAI灵骏智算资源（Serverless版）大模型最佳实践
  ALIYUN::ROS::Composer:
    a5306476:
      Rect:
        - 300
        - 280
        - 40
        - 100
        - 1
        - 0
      ResT: Composer::ROSParameter::AlibabaCloud
    92e8cf47:
      Parent: a5306476
      Rect:
        - 260
        - 210
        - 60
        - 150
        - 2
        - 0
      ResT: Composer::ROSParameter::Region
    c96d2905:
      Res:
        - SecurityGroup
      Parent: 92e8cf47
      Rect:
        - 160
        - 120
        - 110
        - 200
        - 10
        - 0
    0db32e00:
      Res:
        - OssBucket
      Parent: 92e8cf47
      Rect:
        - 40
        - 40
        - 80
        - 200
        - 11
        - 0
      Hidden: true
    b1917490:
      Res:
        - ModuleVpcAndVswitch
      Parent: 92e8cf47
      Rect:
        - 40
        - 40
        - 170
        - 235
        - 11
        - 0
      ResT: MODULE::ACS::VPC::OptionalVpcAndVSwitch
