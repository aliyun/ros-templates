ROSTemplateFormatVersion: '2015-09-01'
Transform: Aliyun::Terraform-v1.5
Metadata:
  ALIYUN::ROS::Interface:
    TemplateTags:
      - acs:technical-solution:data-analysis:Lightweight High-Performance OLAP Analysis Based on Hologres-tech_solu_146
Workspace:
  variable.tf: |-
    # ------------------------------------------------------------------------------
    # Module Input Variables
    #
    # This file defines all configurable input variables for this Terraform module.
    # Each variable contains detailed descriptions to help users configure the module correctly.
    # ------------------------------------------------------------------------------

    # Specifies the Alibaba Cloud availability zone where resources will be created. Default is ap-southeast-3b.
    variable "zone_id" {
      type        = string
      description = "Select availability zone"
      default     = "ap-southeast-3b"
    }
  main.tf: |-
    # ------------------------------------------------------------------------------
    # Main Resource Definitions
    #
    # This file contains the core infrastructure resources of the module.
    # The code here is responsible for creating and configuring all cloud resources based on input variables.
    # ------------------------------------------------------------------------------

    # Configure the Alibaba Cloud provider.
    provider "alicloud" {
      region = "ap-southeast-3"
    }

    # Create a random ID.
    resource "random_id" "suffix" {
      byte_length = 8
    }

    # Define local variables.
    locals {
      common_name = "olap-analysis-${random_id.suffix.id}"
    }

    # Create a VPC.
    resource "alicloud_vpc" "vpc" {
      cidr_block = "192.168.0.0/16"
      vpc_name   = "${local.common_name}-vpc"
    }

    # Create a VSwitch.
    resource "alicloud_vswitch" "vswitch" {
      vpc_id       = alicloud_vpc.vpc.id
      cidr_block   = "192.168.0.0/24"
      zone_id      = var.zone_id
      vswitch_name = "${local.common_name}-vsw"
    }

    # Create a Hologram instance.
    resource "alicloud_hologram_instance" "hologram" {
      instance_type = "Standard"
      zone_id       = var.zone_id
      payment_type  = "PayAsYouGo"
      pricing_cycle = "Hour"
      cpu           = 32
      instance_name = "${local.common_name}-hologram"

      # Configure intranet endpoint.
      endpoints {
        type = "Intranet"
      }

      # Configure VPC single tunnel endpoint.
      endpoints {
        vpc_id     = alicloud_vpc.vpc.id
        vswitch_id = alicloud_vswitch.vswitch.id
        type       = "VPCSingleTunnel"
      }

      # Configure internet endpoint.
      endpoints {
        type = "Internet"
      }
    }
  output.tf: |-
    # ------------------------------------------------------------------------------
    # Module Outputs
    #
    # This file defines the values returned to the caller after successful module execution.
    # These outputs can be referenced by other Terraform configurations or displayed to users after the apply command completes.
    # ------------------------------------------------------------------------------

    # Outputs the Hologram instance id.
    output "hologram_instance_id" {
      value       = alicloud_hologram_instance.hologram.id
      description = "Hologram instance id"
    }

    # Outputs the VPC instance id.
    output "vpc_instance_id" {
      value       = alicloud_vpc.vpc.id
      description = "VPC instance id"
    }

    # Outputs the vswitch instance id.
    output "vswitch_instance_id" {
      value       = alicloud_vswitch.vswitch.id
      description = "vSwitch instance id"
    }

    # Outputs the JDBC connection address.
    output "jdbcaddress" {
      value       = "rm-bp1z69dodhh85z9qa.mysql.rds.aliyuncs.com:3306"
      description = "JDBC connection address"
    }

    # Outputs the database name.
    output "data_base_name" {
      value       = "github_events_share"
      description = "Database name"
    }

    # Outputs the database username.
    output "data_base_user_name" {
      value       = "workshop"
      description = "Database username"
    }

    # Outputs the database password.
    output "data_base_password" {
      value       = "workshop#2017"
      description = "Database password"
    }
