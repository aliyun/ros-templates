ROSTemplateFormatVersion: '2015-09-01'
Description:
  zh-cn: 单账号多环境RAM用户与资源治理方案，含VPC、ECS、OSS、RDS资源分组、权限配置及自动化部署策略。
  en: Single-account Multi-environment RAM User and Resource Governance Solution,
    encompassing VPC, ECS, OSS, RDS resource grouping, permission configurations,
    and automated deployment strategies.
Parameters:
  ResourceGroupId1Dev:
    Type: String
    Label:
      en: Development Resource Group ID
      zh-cn: 开发资源组ID
    Description:
      en: <font color='blue'><b>Development environment resource group ID where the
        instance is located
      zh-cn: <font color='blue'><b>实例所在的开发环境资源组ID。
    MinLength: 3
  ResourceGroupId2Prod:
    Type: String
    Label:
      en: Production Resource Group ID
      zh-cn: 生产资源组ID
    Description:
      en: <font color='blue'><b>The production environment resource group ID of the
        instance
      zh-cn: <font color='blue'><b>实例所在的生产环境资源组ID。
    MinLength: 3
  ResourceGroupId3Test:
    Type: String
    Label:
      en: Test Resource Group ID
      zh-cn: 测试资源组ID
    Description:
      en: <font color='blue'><b>The test environment resource group ID of the instance
      zh-cn: <font color='blue'><b>实例所在的测试环境资源组ID。
    MinLength: 3
  VpcCidrBlock1Dev:
    Type: String
    Label:
      en: Develop Environment VPC CIDR Block
      zh-cn: 开发环境专有网络网段
    Description:
      en: Develop Environment VPC CIDR Block
      zh-cn: 开发环境专有网络网段
    Default: 172.16.0.0/12
    AllowedValues:
    - 10.0.0.0/8
    - 172.16.0.0/12
    - 192.168.0.0/16
  VpcCidrBlock2Prod:
    Type: String
    Label:
      en: Production Environment VPC CIDR Block
      zh-cn: 生产环境专有网络网段
    Description:
      en: Production Environment VPC CIDR Block
      zh-cn: 生产环境专有网络网段
    Default: 10.0.0.0/8
    AllowedValues:
    - 10.0.0.0/8
    - 172.16.0.0/12
    - 192.168.0.0/16
  VpcCidrBlock3Test:
    Type: String
    Label:
      en: Test Environment VPC CIDR Block
      zh-cn: 测试环境专有网络网段
    Description:
      en: Test Environment VPC CIDR Block
      zh-cn: 测试环境专有网络网段
    Default: 192.168.0.0/16
    AllowedValues:
    - 10.0.0.0/8
    - 172.16.0.0/12
    - 192.168.0.0/16
  VSwitchZoneId:
    Type: String
    Label:
      en: VSwitch Availability Zone
      zh-cn: 交换机可用区
    Description:
      en: Availability Zone ID,<br><b>note： <font color='blue'>Before selecting, please
        confirm that the Availability Zone supports the specification of creating
        ECS resources</font></b>
      zh-cn: 可用区ID。<br><b>注： <font color='blue'>选择可用区前请确认该可用区是否支持创建ECS资源的规格</font></b>
    AssociationProperty: ALIYUN::ECS::Instance:ZoneId
  VSwitchCidrBlockDev:
    Type: String
    Label:
      en: Develop VSwitch CIDR Block
      zh-cn: 开发交换机网段
    Description:
      en: Must be a sub-network segment of the proprietary network and is not occupied
        by other VSwitches.
      zh-cn: 必须是所属专有网络的子网段，并且没有被其他交换机占用。
    Default: 172.16.10.0/24
  VSwitchCidrBlockProd:
    Type: String
    Label:
      en: Production VSwitch CIDR Block
      zh-cn: 生产交换机网段
    Description:
      en: Must be a sub-network segment of the proprietary network and is not occupied
        by other VSwitches.
      zh-cn: 必须是所属专有网络的子网段，并且没有被其他交换机占用。
    Default: 10.0.10.0/24
  VSwitchCidrBlockTest:
    Type: String
    Label:
      en: Test VSwitch CIDR Block
      zh-cn: 测试交换机网段
    Description:
      en: Must be a sub-network segment of the proprietary network and is not occupied
        by other VSwitches.
      zh-cn: 必须是所属专有网络的子网段，并且没有被其他交换机占用。
    Default: 192.168.10.0/24
  EcsInstanceType:
    Type: String
    Label:
      en: Instance Type
      zh-cn: 实例规格
    Description:
      en: <font color='blue'><b>1.Before selecting the model please confirm that the
        current available zone under the model is in stock, some models need to be
        reported in advance</b></font><br><font color='blue'><b>2.List of optional
        models</font><br></b></font>[ecs.c5.large <font color='green'>2vCPU 4GiB Intranet
        bandwidth1Gbps In-grid sending and receiving packages30MillionPPS</font>]<br></b>[ecs.c5.xlarge
        <font color='green'>4vCPU 8GiB Intranet bandwidth1.5Gbps In-grid sending and
        receiving packages50MillionPPS</font>]<br></b>[ecs.c5.2xlarge <font color='green'>8vCPU
        16GiB Intranet bandwidth2.5Gbps In-grid sending and receiving packages80MillionPPS</font>]
      zh-cn: <font color='blue'><b>1.选择机型前请先确认当前可用区下该机型是否有货，部分机型需要提前报备</b></font><br><font
        color='blue'><b>2.可选机型列表</font><br></b></font>[ecs.c5.large <font color='green'>2vCPU
        4GiB 内网带宽1Gbps 内网收发包30万PPS</font>]<br></b>[ecs.c5.xlarge <font color='green'>4vCPU
        8GiB 内网带宽1.5Gbps 内网收发包50万PPS</font>]<br></b>[ecs.c5.2xlarge <font color='green'>8vCPU
        16GiB 内网带宽2.5Gbps 内网收发包80万PPS</font>]
    AssociationProperty: ALIYUN::ECS::Instance::InstanceType
  EcsImageId:
    Type: String
    Label:
      en: Image
      zh-cn: 镜像
    Description:
      en: Image ID，see detail：<b><a href='https://www.alibabacloud.com/help/en/doc-detail/112977.html'
        target='_blank'><font color='blue'>Find the mirror</font></a></b>
      zh-cn: 镜像ID, 详见：<b><a href='https://help.aliyun.com/document_detail/112977.html'
        target='_blank'><font color='blue'>查找镜像</font></a></b>
    Default: centos_7
  EcsSystemDiskCategory:
    Type: String
    Label:
      en: System Disk Type
      zh-cn: 系统盘类型
    Description:
      en: '<font color=''blue''><b>Optional values:</b></font><br>[cloud_efficiency:
        <font color=''green''>Efficient Cloud Disk</font>]<br>[cloud_ssd: <font color=''green''>SSD
        Cloud Disk</font>]<br>[cloud_essd: <font color=''green''>ESSD Cloud Disk</font>]<br>[cloud:
        <font color=''green''>Cloud Disk</font>]<br>[ephemeral_ssd: <font color=''green''>Local
        SSD Cloud Disk</font>]'
      zh-cn: '<font color=''blue''><b>可选值：</b></font><br>[cloud_efficiency: <font
        color=''green''>高效云盘</font>]<br>[cloud_ssd: <font color=''green''>SSD云盘</font>]<br>[cloud_essd:
        <font color=''green''>ESSD云盘</font>]<br>[cloud: <font color=''green''>普通云盘</font>]<br>[ephemeral_ssd:
        <font color=''green''>本地SSD盘</font>]'
    Default: cloud_efficiency
    AllowedValues:
    - cloud_efficiency
    - cloud_ssd
    - cloud
    - cloud_essd
    - ephemeral_ssd
  EcsGroupSystemDiskSize:
    Type: Number
    Label:
      en: System Disk Space
      zh-cn: 系统盘空间
    Description:
      en: 'System disk size, range of values: 40-500, units: GB.'
      zh-cn: 系统盘大小, 取值范围：[40, 500], 单位：GB。
    Default: 40
  EcsPassword:
    Type: String
    Label:
      en: Instance Password
      zh-cn: 实例密码
    Description:
      en: Server login password, Length 8-30, must contain three(Capital letters,
        lowercase letters, numbers, ()`~!@#$%^&*_-+=|{}[]:;'<>,.?/ Special symbol
        in).
      zh-cn: 服务器登录密码,长度8-30，必须包含三项（大写字母、小写字母、数字、 ()`~!@#$%^&*_-+=|{}[]:;'<>,.?/ 中的特殊符号）。
    ConstraintDescription:
      en: Length 8-30, must contain three(Capital letters, lowercase letters, numbers,
        ()`~!@#$%^&*_-+=|{}[]:;'<>,.?/ Special symbol in).
      zh-cn: 长度8-30，必须包含三项（大写字母、小写字母、数字、 ()`~!@#$%^&*_-+=|{}[]:;'<>,.?/ 中的特殊符号）。
    AllowedPattern: '[0-9A-Za-z\_\-\&:;''<>,=%`~!@#\(\)\$\^\*\+\|\{\}\[\]\.\?\/]+$'
    MinLength: 8
    MaxLength: 30
    NoEcho: true
  DBInstanceEngineAndVersion:
    Type: String
    Label:
      en: Type And Version
      zh-cn: 类型与版本号
    Description:
      en: Database type and version number.
      zh-cn: 数据库类型与版本号。
    Default: MySQL-5.7
    AllowedValues:
    - MySQL-5.5
    - MySQL-5.6
    - MySQL-5.7
    - MySQL-8.0
  DBInstanceClass:
    Type: String
    Label:
      en: Specifications
      zh-cn: 实例规格
    Description:
      en: 'Select the instance specification based on the type of database engine
        and the available area support;<br>See detail: <a href=''https://www.alibabacloud.com/help/doc-detail/26312.htm''
        target=''_blank''><b><font color=''blue''>Instance specification sheet</font></b></a>'
      zh-cn: 根据数据库引擎的类型和可用的区域支持选择实例规格；<br>请参见详细信息：<a href='https://help.aliyun.com/document_detail/26312.html'
        target='_blank'><b><font color='blue'>实例规格列表</font></b></a>
    Default: rds.mysql.s2.large
    AllowedValues:
    - rds.mysql.s2.large
    - rds.mysql.s2.xlarge
    - rds.mysql.s3.large
    - rds.mysql.m1.medium
    - rds.mysql.c1.large
    - rds.mysql.c1.xlarge
  DBInstanceStorage:
    Type: Number
    Label:
      en: Storage Space
      zh-cn: 存储空间
    Description:
      en: 'Database storage space, units: GB, per 5GB increment, value range: 5-1000.'
      zh-cn: 数据库存储空间, 单位：GB, 每5GB进行递增，取值范围：5-1000。
    Default: 5
    MinValue: 5
    MaxValue: 1000
  BucketAccessControl:
    Type: String
    Label:
      en: Access Control
      zh-cn: 读写权限
    Description:
      en: '<font color=''blue''><b>Optional values: </b></font><br>[private：<font
        color=''green''>All access to the file requires authentication</font>]<br>[public-read：<font
        color=''green''>File writes need to be authenticated；Files can be read anonymously</font>]<br>[public-read-write：<font
        color=''green''>Anyone (including anonymous visitors) can perform read and
        write operators on the files in the bucket</font>]'
      zh-cn: '<font color=''blue''><b>可选值: </b></font><br>[private：<font color=''green''>对文件的所有访问操作需要进行身份验证</font>]<br>[public-read：<font
        color=''green''>对文件写操作需要进行身份验证；可以对文件进行匿名读</font>]<br>[public-read-write：<font
        color=''green''>所有人都可以对文件进行读写操作</font>]'
    Default: private
    AllowedValues:
    - private
    - public-read
    - public-read-write
  BucketStorageClass:
    Type: String
    Label:
      en: Storage Type
      zh-cn: 存储类型
    Description:
      en: '<font color=''blue''><b>Optional values: </b></font><br>[Standard：<font
        color=''green''>Standard storage type</font>]<br>[IA：<font color=''green''>Low
        frequency access storage type</font>]<br>[Archive：<font color=''green''>Archive
        storage type</font>]'
      zh-cn: '<font color=''blue''><b>可选值: </b></font><br>[Standard：<font color=''green''>标准存储类型</font>]<br>[IA：<font
        color=''green''>低频访问存储类型</font>]<br>[Archive：<font color=''green''>归档存储类型</font>]'
    Default: Standard
    AllowedValues:
    - Standard
    - IA
    - Archive
  BucketName1Dev:
    Type: String
    Label:
      en: Develop Bucket Name
      zh-cn: 开发存储空间名称
    Description:
      en: The name must be 3 to 63 bytes in length, The name must start and end with
        a lowercase letter or digit.The name can contain only lowercase letters, digits,
        and hyphens (-);<br><b>note：<font color='blue'>A bucket name must be globally
        unique within OSS. Bucket names cannot be changed after the bucket is created.</b></font>
      zh-cn: 长度为3~63个字符，必须以小写字母或数字开头和结尾，可以包含小写字母、数字和连字符(-);<br><font color='blue'><b>注：需要全网唯一性，已经存在的不能在创建</b></font>
    Default: ros-projects-dev
  BucketName2Prod:
    Type: String
    Label:
      en: Production Bucket Name
      zh-cn: 生产存储空间名称
    Description:
      en: The name must be 3 to 63 bytes in length, The name must start and end with
        a lowercase letter or digit.The name can contain only lowercase letters, digits,
        and hyphens (-);<br><b>note：<font color='blue'>A bucket name must be globally
        unique within OSS. Bucket names cannot be changed after the bucket is created.</b></font>
      zh-cn: 长度为3~63个字符，必须以小写字母或数字开头和结尾，可以包含小写字母、数字和连字符(-);<br><font color='blue'><b>注：需要全网唯一性，已经存在的不能在创建</b></font>
    Default: ros-projects-prod
  BucketName3Test:
    Type: String
    Label:
      en: Test Bucket Name
      zh-cn: 测试存储空间名称
    Description:
      en: The name must be 3 to 63 bytes in length, The name must start and end with
        a lowercase letter or digit.The name can contain only lowercase letters, digits,
        and hyphens (-);<br><b>note：<font color='blue'>A bucket name must be globally
        unique within OSS. Bucket names cannot be changed after the bucket is created.</b></font>
      zh-cn: 长度为3~63个字符，必须以小写字母或数字开头和结尾，可以包含小写字母、数字和连字符(-);<br><font color='blue'><b>注：需要全网唯一性，已经存在的不能在创建</b></font>
    Default: ros-projects-test
  BucketName4Code:
    Type: String
    Label:
      en: Code Release Bucket Name
      zh-cn: 代码发布空间名称
    Description:
      en: The name must be 3 to 63 bytes in length, The name must start and end with
        a lowercase letter or digit.The name can contain only lowercase letters, digits,
        and hyphens (-);<br><b>note：<font color='blue'>A bucket name must be globally
        unique within OSS. Bucket names cannot be changed after the bucket is created.</b></font>
      zh-cn: 长度为3~63个字符，必须以小写字母或数字开头和结尾，可以包含小写字母、数字和连字符(-);<br><font color='blue'><b>注：需要全网唯一性，已经存在的不能在创建</b></font>
    Default: ros-projects-code
  BucketName5Other:
    Type: String
    Label:
      en: Other Bucket Name
      zh-cn: 其他存储空间名称
    Description:
      en: The name must be 3 to 63 bytes in length, The name must start and end with
        a lowercase letter or digit.The name can contain only lowercase letters, digits,
        and hyphens (-);<br><b>note：<font color='blue'>A bucket name must be globally
        unique within OSS. Bucket names cannot be changed after the bucket is created.</b></font>
      zh-cn: 长度为3~63个字符，必须以小写字母或数字开头和结尾，可以包含小写字母、数字和连字符(-);<br><font color='blue'><b>注：需要全网唯一性，已经存在的不能在创建</b></font>
    Default: ros-projects-other
  BucketName4CodeFolderName:
    Type: String
    Label:
      en: Publish Directory
      zh-cn: 发布存储空间发布目录
    Description:
      en: The directory to be created in the publishing storage space divides the
        read and write permissions of user groups to the publishing storage space
        folder，;<br> does not allow names like ”/“or “..”Subdirectory, length 1-254
        characters.
      zh-cn: 即将在发布存储空间创建的目录，划分用户组对发布存储空间文件夹的读写权限；<br>不允许出现名为 “/”或“..”的子目录，长度1-254个字符。
    Default: release
    MinLength: 1
    MaxLength: 254
  BucketName5CodeFolderName:
    Type: String
    Label:
      en: Production Directory
      zh-cn: 发布存储空间生产目录
    Description:
      en: The directory to be created in the publishing storage space divides the
        read and write permissions of user groups to the publishing storage space
        folder，;<br> does not allow names like ”/“or “..”Subdirectory, length 1-254
        characters.
      zh-cn: 即将在发布存储空间创建的目录，划分用户组对发布存储空间文件夹的读写权限；<br>不允许出现名为 “/”或“..”的子目录，长度1-254个字符。
    Default: prod
    MinLength: 1
    MaxLength: 254
  GroupName4Sa:
    Type: String
    Label:
      en: Operation User Group Name
      zh-cn: 运维用户组名称
    Description:
      en: 'Operation group user group, 1 to 64 characters in length, including English
        letters, Numbers, and hyphens (-);<br><b>note: <font color=''blue''>unique
        in account</b></font>'
      zh-cn: 运维组用户组, 长度为1~64个字符，可包含英文字母、数字，和连字符（-）；<br><b>注：<font color='blue'>账号内唯一</b></font>
    Default: sa
  GroupName5Dev:
    Type: String
    Label:
      en: Develop User Group Name
      zh-cn: 开发用户组名称
    Description:
      en: 'Develop group user group, 1 to 64 characters in length, including English
        letters, Numbers, and hyphens (-);<br><b>note: <font color=''blue''>unique
        in account</b></font>'
      zh-cn: 开发组用户组名称, 长度为1~64个字符，可包含英文字母、数字，和连字符（-）；<br><b>注：<font color='blue'>账号内唯一</b></font>
    Default: dev
  GroupName6Test:
    Type: String
    Label:
      en: Test User Group Name
      zh-cn: 测试用户组名称
    Description:
      en: 'Test group user group, 1 to 64 characters in length, including English
        letters, Numbers, and hyphens (-);<br><b>note: <font color=''blue''>unique
        in account</b></font>'
      zh-cn: 测试用户组名称, 长度为1~64个字符，可包含英文字母、数字，和连字符（-）；<br><b>注：<font color='blue'>账号内唯一</b></font>
    Default: test
  GroupName1AppDev:
    Type: String
    Label:
      en: Development Environment User Group Name
      zh-cn: 开发环境程序用户组名称
    Description:
      en: 'Development environment user group name, 1 to 64 characters in length,
        including English letters, Numbers, and hyphens (-);<br><b>note: <font color=''blue''>unique
        in account</b></font>'
      zh-cn: 开发环境程序组用户组, 长度为1~64个字符，可包含英文字母、数字，和连字符（-）；<br><b>注：<font color='blue'>账号内唯一</b></font>
    Default: app-dev
  GroupName2AppProd:
    Type: String
    Label:
      en: Production Environment User Group Name
      zh-cn: 生产环境程序用户组名称
    Description:
      en: 'Production environment user group name, 1 to 64 characters in length, including
        English letters, Numbers, and hyphens (-);<br><b>note: <font color=''blue''>unique
        in account</b></font>'
      zh-cn: 生产环境程序组用户组, 长度为1~64个字符，可包含英文字母、数字，和连字符（-）；<br><font color='blue'><b>注：账号内唯一</b></font>
    Default: app-prod
  GroupName3AppTest:
    Type: String
    Label:
      en: Test Environment User Group Name
      zh-cn: 测试环境程序用户组名称
    Description:
      en: 'Test environment user group name, 1 to 64 characters in length, including
        English letters, Numbers, and hyphens (-);<br><b>note: <font color=''blue''>unique
        in account</b></font>'
      zh-cn: 测试环境程序组用户组, 长度为1~64个字符，可包含英文字母、数字，和连字符（-）；<br><b>注：<font color='blue'>账号内唯一</b></font>
    Default: app-test
  UserName1Dev:
    Type: String
    Label:
      en: Development Permission User Name
      zh-cn: 开发权限用户名
    Description:
      en: 'Development rights user name, 1 to 64 characters in length, including English
        letters, Numbers, and hyphens (-);<br><b>note: <font color=''blue''>unique
        in account</b></font>'
      zh-cn: 开发账号用户名, 长度为1~64个字符，可包含英文字母、数字，和连字符（-）；<br><b>注：<font color='blue'>账号内唯一</b></font>
    ConstraintDescription:
      en: '[1, 64] bits contain a maximum of 64 characters.format：^[a-zA-Z0-9\.@\-_]+$。'
      zh-cn: '[1, 64]位最多包含64个字符。格式：^[a-zA-Z0-9\.@\-_]+$。'
    Default: sts_dev
    MinLength: 1
  UserName2Prod:
    Type: String
    Label:
      en: Production Permission User Name
      zh-cn: 生产权限用户名
    Description:
      en: 'Production permission user name, 1 to 64 characters in length, including
        English letters, Numbers, and hyphens (-);<br><b>note: <font color=''blue''>unique
        in account</b></font>'
      zh-cn: 生产账号用户名, 长度为1~64个字符，可包含英文字母、数字，和连字符（-）；<br><b>注：<font color='blue'>账号内唯一</b></font>
    ConstraintDescription:
      en: '[1, 64] bits contain a maximum of 64 characters.format：^[a-zA-Z0-9\.@\-_]+$。'
      zh-cn: '[1, 64]位最多包含64个字符。格式：^[a-zA-Z0-9\.@\-_]+$。'
    Default: sts_prod
    MinLength: 1
  UserName3Test:
    Type: String
    Label:
      en: Test Permission User Name
      zh-cn: 测试权限用户名
    Description:
      en: 'Test permission user name, 1 to 64 characters in length, including English
        letters, Numbers, and hyphens (-);<br><b>note: <font color=''blue''>unique
        in account</b></font>'
      zh-cn: 测试帐号用户名, 长度为1~64个字符，可包含英文字母、数字，和连字符（-）；<br><b>注：<font color='blue'>账号内唯一</b></font>
    ConstraintDescription:
      en: '[1, 64] bits contain a maximum of 64 characters.format：^[a-zA-Z0-9\.@\-_]+$。'
      zh-cn: '[1, 64]位最多包含64个字符。格式：^[a-zA-Z0-9\.@\-_]+$。'
    Default: sts_test
    MinLength: 1
Resources:
  EcsVpc1Dev:
    Type: ALIYUN::ECS::VPC
    Properties:
      CidrBlock:
        Ref: VpcCidrBlock1Dev
      ResourceGroupId:
        Ref: ResourceGroupId1Dev
      VpcName:
        Fn::Join:
        - '-'
        - - Dev-StackId
          - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: ce657371-5d20-4779-9d6d-21a4c7b627d2
  EcsSecurityGroup1Dev:
    Type: ALIYUN::ECS::SecurityGroup
    Properties:
      VpcId:
        Ref: EcsVpc1Dev
      SecurityGroupIngress:
      - IpProtocol: icmp
        NicType: internet
        PortRange: -1/-1
        Priority: 1
        SourceCidrIp: 0.0.0.0/0
      - IpProtocol: tcp
        NicType: internet
        PortRange: 80/80
        Priority: 1
        SourceCidrIp: 0.0.0.0/0
      - IpProtocol: tcp
        NicType: internet
        PortRange: 443/443
        Priority: 1
        SourceCidrIp: 0.0.0.0/0
      - IpProtocol: tcp
        NicType: internet
        PortRange: 22/22
        Priority: 1
        SourceCidrIp: 0.0.0.0/0
      SecurityGroupName:
        Fn::Join:
        - '-'
        - - Dev-StackId
          - Ref: ALIYUN::StackId
      Tags:
      - Key: best_practice
        Value: '051'
    Metadata:
      ALIYUN::ROS::Designer:
        id: e66ecbac-da4a-44f2-b74e-c47dd3d88f53
  EcsVSwitch1Dev:
    Type: ALIYUN::ECS::VSwitch
    Properties:
      ZoneId:
        Ref: VSwitchZoneId
      VpcId:
        Ref: EcsVpc1Dev
      CidrBlock:
        Ref: VSwitchCidrBlockDev
      VSwitchName:
        Fn::Join:
        - '-'
        - - Dev-VSwitch-StackId
          - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: 794bd95b-525f-4fda-8fae-875ce12842d7
  RamRole1Dev:
    Type: ALIYUN::RAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
        - Action: sts:AssumeRole
          Effect: Allow
          Principal:
            Service:
            - actiontrail.aliyuncs.com
        Version: '1'
      Description: projects-dev读写角色
      RoleName:
        Fn::Join:
        - '-'
        - - projects-dev-rw
          - StackId
          - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: 7deb0cd2-4c08-4cde-9794-928907016062
  RamUser1Dev:
    Type: ALIYUN::RAM::User
    Properties:
      DisplayName: 开发STSToken
      Policies:
      - Description: '扮演role-projects-dev-rw角色权限 '
        PolicyDocument:
          Statement:
          - Action:
            - sts:AssumeRole
            Effect: Allow
            Resource:
            - Fn::GetAtt:
              - RamRole1Dev
              - Arn
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - assume_role-projects-dev-rw
            - StackId
            - Ref: ALIYUN::StackId
      UserName:
        Ref: UserName1Dev
    Metadata:
      ALIYUN::ROS::Designer:
        id: aab44ffa-a7a5-4bd8-898c-852111f32ef5
  RamAccessKey1Dev:
    Type: ALIYUN::RAM::AccessKey
    Properties:
      UserName:
        Ref: RamUser1Dev
    DependsOn: RamUser1Dev
    Metadata:
      ALIYUN::ROS::Designer:
        id: aca9826b-7f95-439f-a237-76ab291f0118
  EcsInstance1Dev:
    Type: ALIYUN::ECS::Instance
    Properties:
      VpcId:
        Ref: EcsVpc1Dev
      VSwitchId:
        Ref: EcsVSwitch1Dev
      SecurityGroupId:
        Ref: EcsSecurityGroup1Dev
      ImageId:
        Ref: EcsImageId
      AllocatePublicIP: true
      InstanceChargeType: PostPaid
      InstanceType:
        Ref: EcsInstanceType
      InternetMaxBandwidthOut: 1
      IoOptimized: optimized
      Password:
        Ref: EcsPassword
      ResourceGroupId:
        Ref: ResourceGroupId1Dev
      SystemDiskCategory:
        Ref: EcsSystemDiskCategory
      SystemDiskSize:
        Ref: EcsGroupSystemDiskSize
      Tags:
      - Key: best_practice
        Value: '051'
      UserData:
        Fn::Replace:
        - ros-notify:
            Fn::GetAtt:
            - RosWaitConditionHandle
            - CurlCli
        - Fn::Join:
          - ''
          - - "#!/bin/sh \n"
            - "export hostname=`hostname` \n"
            - "sed -i '/127.0.0.1/d' /etc/hosts \n"
            - "echo \"127.0.0.1       $hostname\" >> /etc/hosts \n"
            - "echo '127.0.0.1       localhost' >> /etc/hosts \n"
            - export access_key_id=
            - Fn::GetAtt:
              - RamAccessKey1Dev
              - AccessKeyId
            - " \n"
            - export access_key_secret=
            - Fn::GetAtt:
              - RamAccessKey1Dev
              - AccessKeySecret
            - " \n"
            - export bucket_name=
            - Ref: BucketName4Code
            - " \n"
            - export endpoint=
            - Fn::Join:
              - ''
              - - http://oss-
                - Ref: ALIYUN::Region
                - -internal.aliyuncs.com
            - " \n"
            - export bucket_dir1=
            - Ref: BucketName4CodeFolderName
            - '

              '
            - export bucket_dir2=
            - Ref: BucketName5CodeFolderName
            - '

              '
            - "wget http://gosspublic.alicdn.com/ossutil/1.6.10/ossutil64 \n"
            - "chmod 755 ossutil64 \n"
            - "./ossutil64 config -k $access_key_secret -i $access_key_id -e $endpoint\
              \ \n"
            - ./ossutil64 mkdir oss://
            - Ref: BucketName4Code
            - "/$bucket_dir1/ \n"
            - "./ossutil64 config -k $access_key_secret -i $access_key_id -e $endpoint\
              \ \n"
            - ./ossutil64 mkdir oss://
            - Ref: BucketName4Code
            - "/$bucket_dir2/ \n"
            - "ros-notify -d \"{\\\"Data\\\" : \\\"Success\\\", \\\"Status\\\" : \\\
              \"Success\\\"}\" \n"
    DependsOn:
    - RamAccessKey1Dev
    - RamUser1Dev
    Metadata:
      ALIYUN::ROS::Designer:
        id: 862da07d-7b3c-4e05-9843-624a3c711269
  EcsVpc2Prod:
    Type: ALIYUN::ECS::VPC
    Properties:
      CidrBlock:
        Ref: VpcCidrBlock2Prod
      ResourceGroupId:
        Ref: ResourceGroupId2Prod
      VpcName:
        Fn::Join:
        - '-'
        - - Prod-StackId
          - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: 097c50f2-9a75-4da8-b255-d4666e1a3df1
  EcsSecurityGroup2Prod:
    Type: ALIYUN::ECS::SecurityGroup
    Properties:
      VpcId:
        Ref: EcsVpc2Prod
      SecurityGroupIngress:
      - IpProtocol: icmp
        NicType: internet
        PortRange: -1/-1
        Priority: 1
        SourceCidrIp: 0.0.0.0/0
      - IpProtocol: tcp
        NicType: internet
        PortRange: 80/80
        Priority: 1
        SourceCidrIp: 0.0.0.0/0
      - IpProtocol: tcp
        NicType: internet
        PortRange: 443/443
        Priority: 1
        SourceCidrIp: 0.0.0.0/0
      - IpProtocol: tcp
        NicType: internet
        PortRange: 22/22
        Priority: 1
        SourceCidrIp: 0.0.0.0/0
      SecurityGroupName:
        Fn::Join:
        - '-'
        - - Prod-StackId
          - Ref: ALIYUN::StackId
      Tags:
      - Key: best_practice
        Value: '051'
    Metadata:
      ALIYUN::ROS::Designer:
        id: 8c5dac94-b362-4011-948c-6ad3a3abcaac
  EcsVSwitch2Prod:
    Type: ALIYUN::ECS::VSwitch
    Properties:
      ZoneId:
        Ref: VSwitchZoneId
      VpcId:
        Ref: EcsVpc2Prod
      CidrBlock:
        Ref: VSwitchCidrBlockProd
      VSwitchName:
        Fn::Join:
        - '-'
        - - Prod-VSwitch-StackId
          - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: 5df8cc6d-0d20-4b84-969d-6ca110774eb2
  EcsInstance2Prod:
    Type: ALIYUN::ECS::Instance
    Properties:
      VpcId:
        Ref: EcsVpc2Prod
      VSwitchId:
        Ref: EcsVSwitch2Prod
      SecurityGroupId:
        Ref: EcsSecurityGroup2Prod
      ImageId:
        Ref: EcsImageId
      AllocatePublicIP: false
      InstanceChargeType: PostPaid
      InstanceType:
        Ref: EcsInstanceType
      InternetMaxBandwidthOut: 0
      IoOptimized: optimized
      Password:
        Ref: EcsPassword
      ResourceGroupId:
        Ref: ResourceGroupId2Prod
      SystemDiskCategory:
        Ref: EcsSystemDiskCategory
      SystemDiskSize:
        Ref: EcsGroupSystemDiskSize
      Tags:
      - Key: best_practice
        Value: '051'
    Metadata:
      ALIYUN::ROS::Designer:
        id: 783320d2-9319-4f8d-adc6-4ef8776d2f45
  EcsVpc3Test:
    Type: ALIYUN::ECS::VPC
    Properties:
      CidrBlock:
        Ref: VpcCidrBlock3Test
      ResourceGroupId:
        Ref: ResourceGroupId3Test
      VpcName:
        Fn::Join:
        - '-'
        - - Test-StackId
          - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: 6b185598-0614-49f2-8ac6-76c4552592d0
  EcsSecurityGroup3Test:
    Type: ALIYUN::ECS::SecurityGroup
    Properties:
      VpcId:
        Ref: EcsVpc3Test
      SecurityGroupIngress:
      - IpProtocol: icmp
        NicType: internet
        PortRange: -1/-1
        Priority: 1
        SourceCidrIp: 0.0.0.0/0
      - IpProtocol: tcp
        NicType: internet
        PortRange: 80/80
        Priority: 1
        SourceCidrIp: 0.0.0.0/0
      - IpProtocol: tcp
        NicType: internet
        PortRange: 443/443
        Priority: 1
        SourceCidrIp: 0.0.0.0/0
      - IpProtocol: tcp
        NicType: internet
        PortRange: 22/22
        Priority: 1
        SourceCidrIp: 0.0.0.0/0
      SecurityGroupName:
        Fn::Join:
        - '-'
        - - Test-StackId
          - Ref: ALIYUN::StackId
      Tags:
      - Key: best_practice
        Value: '051'
    Metadata:
      ALIYUN::ROS::Designer:
        id: a032374f-7bf5-4eab-8665-7e29f3ab9ff6
  EcsVSwitch3Test:
    Type: ALIYUN::ECS::VSwitch
    Properties:
      ZoneId:
        Ref: VSwitchZoneId
      VpcId:
        Ref: EcsVpc3Test
      CidrBlock:
        Ref: VSwitchCidrBlockTest
      VSwitchName:
        Fn::Join:
        - '-'
        - - Test-VSwitch-StackId
          - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: 8b6fcb8c-8354-42b5-bf9a-162f248ebb37
  EcsInstance3Test:
    Type: ALIYUN::ECS::Instance
    Properties:
      VpcId:
        Ref: EcsVpc3Test
      VSwitchId:
        Ref: EcsVSwitch3Test
      SecurityGroupId:
        Ref: EcsSecurityGroup3Test
      ImageId:
        Ref: EcsImageId
      AllocatePublicIP: false
      InstanceChargeType: PostPaid
      InstanceType:
        Ref: EcsInstanceType
      InternetMaxBandwidthOut: 0
      IoOptimized: optimized
      Password:
        Ref: EcsPassword
      ResourceGroupId:
        Ref: ResourceGroupId3Test
      SystemDiskCategory:
        Ref: EcsSystemDiskCategory
      SystemDiskSize:
        Ref: EcsGroupSystemDiskSize
      Tags:
      - Key: best_practice
        Value: '051'
    Metadata:
      ALIYUN::ROS::Designer:
        id: b0500ea3-d883-4eb4-97f0-3d72f7a946f0
  OssBucket1Dev:
    Type: ALIYUN::OSS::Bucket
    Properties:
      AccessControl:
        Ref: BucketAccessControl
      BucketName:
        Ref: BucketName1Dev
      DeletionForce: true
      StorageClass:
        Ref: BucketStorageClass
      Tags:
        Key: best_practice
        Value: '051'
    Metadata:
      ALIYUN::ROS::Designer:
        id: fcc2906e-1b34-4746-9c99-979112a0961a
  OssBucket2Prod:
    Type: ALIYUN::OSS::Bucket
    Properties:
      AccessControl:
        Ref: BucketAccessControl
      BucketName:
        Ref: BucketName2Prod
      DeletionForce: true
      StorageClass:
        Ref: BucketStorageClass
      Tags:
        Key: best_practice
        Value: '051'
    Metadata:
      ALIYUN::ROS::Designer:
        id: f8d2aa33-0494-4a8d-9d45-3af90273961d
  OssBucket3Test:
    Type: ALIYUN::OSS::Bucket
    Properties:
      AccessControl:
        Ref: BucketAccessControl
      BucketName:
        Ref: BucketName3Test
      DeletionForce: true
      StorageClass:
        Ref: BucketStorageClass
      Tags:
        Key: best_practice
        Value: '051'
    Metadata:
      ALIYUN::ROS::Designer:
        id: d4085be3-0c4d-42f0-b85f-437bdf0eeb6c
  OssBucket4Code:
    Type: ALIYUN::OSS::Bucket
    Properties:
      AccessControl:
        Ref: BucketAccessControl
      BucketName:
        Ref: BucketName4Code
      DeletionForce: true
      StorageClass:
        Ref: BucketStorageClass
      Tags:
        Key: best_practice
        Value: '051'
    Metadata:
      ALIYUN::ROS::Designer:
        id: 2d40b6f2-2d64-445a-b442-f1da03b1dc19
  OssBucket5Other:
    Type: ALIYUN::OSS::Bucket
    Properties:
      AccessControl:
        Ref: BucketAccessControl
      BucketName:
        Ref: BucketName5Other
      DeletionForce: true
      StorageClass:
        Ref: BucketStorageClass
      Tags:
        Key: best_practice
        Value: '051'
    DependsOn:
    - EcsInstance3Test
    Metadata:
      ALIYUN::ROS::Designer:
        id: d9fb59df-e552-4fa1-a5d8-bff3c30303fa
  RamRole2Prod:
    Type: ALIYUN::RAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
        - Action: sts:AssumeRole
          Effect: Allow
          Principal:
            Service:
            - actiontrail.aliyuncs.com
        Version: '1'
      Description: projects-prod读写角色
      RoleName:
        Fn::Join:
        - '-'
        - - projects-prod-rw
          - StackId
          - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: 3c816a38-a719-44d7-bd58-fd6712f2767e
  RamUser2Prod:
    Type: ALIYUN::RAM::User
    Properties:
      DisplayName: 生产STSToken
      Policies:
      - Description: 扮演role-projects-prod-rw角色权限
        PolicyDocument:
          Statement:
          - Action:
            - sts:AssumeRole
            Effect: Allow
            Resource:
            - Fn::GetAtt:
              - RamRole2Prod
              - Arn
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - assume_role-projects-prod-rw
            - StackId
            - Ref: ALIYUN::StackId
      UserName:
        Ref: UserName2Prod
    Metadata:
      ALIYUN::ROS::Designer:
        id: 1ab08305-fbed-4304-a9b7-c5e2596de46b
  RamAccessKey2Prod:
    Type: ALIYUN::RAM::AccessKey
    Properties:
      UserName:
        Ref: RamUser2Prod
    DependsOn: RamUser2Prod
    Metadata:
      ALIYUN::ROS::Designer:
        id: ce72a34a-f0ce-48ab-ba68-e830f785c75d
  RamRole3Test:
    Type: ALIYUN::RAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
        - Action: sts:AssumeRole
          Effect: Allow
          Principal:
            Service:
            - actiontrail.aliyuncs.com
        Version: '1'
      Description: projects-test读写角色
      RoleName:
        Fn::Join:
        - '-'
        - - projects-test-rw
          - StackId
          - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: fa32432b-b74c-4052-b9b9-dce65dc19be9
  RamUser3Test:
    Type: ALIYUN::RAM::User
    Properties:
      DisplayName: 测试STSToken
      Policies:
      - Description: 扮演role-projects-test-rw角色权限
        PolicyDocument:
          Statement:
          - Action:
            - sts:AssumeRole
            Effect: Allow
            Resource:
            - Fn::GetAtt:
              - RamRole3Test
              - Arn
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - assume_role-projects-test-rw
            - StackId
            - Ref: ALIYUN::StackId
      UserName:
        Ref: UserName3Test
    Metadata:
      ALIYUN::ROS::Designer:
        id: 737eccaa-cb07-482e-92e2-66919b57467b
  RamAccessKey3Test:
    Type: ALIYUN::RAM::AccessKey
    Properties:
      UserName:
        Ref: RamUser3Test
    DependsOn: RamUser3Test
    Metadata:
      ALIYUN::ROS::Designer:
        id: ca7d5e0d-57a8-48c4-a57e-baba40f1f349
  RamGroup1AppDev:
    Type: ALIYUN::RAM::Group
    Properties:
      Comments: 开发环境程序组
      GroupName:
        Ref: GroupName1AppDev
      Policies:
      - Description: 程序只读访问project-code release目录权限
        PolicyDocument:
          Statement:
          - Action:
            - oss:ListObjects
            Condition:
              StringLike:
                oss:Prefix:
                - ''
                - Fn::Join:
                  - ''
                  - - Ref: BucketName4CodeFolderName
                    - /*
                - Fn::Join:
                  - ''
                  - - Ref: BucketName4CodeFolderName
                    - /
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName4Code
          - Action:
            - oss:Get*
            - oss:List*
            Condition:
              IpAddress:
                acs:SourceIp:
                - Ref: VpcCidrBlock1Dev
                - Ref: VpcCidrBlock2Prod
                - Ref: VpcCidrBlock3Test
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName4Code
                - /
                - Ref: BucketName4CodeFolderName
                - /*
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - oss_projects-code_release_r_app_dev
            - StackId
            - Ref: ALIYUN::StackId
      - Description: 开发环境读写访问bucket projects-dev权限
        PolicyDocument:
          Statement:
          - Action:
            - oss:PutObject
            - oss:GetObject
            Condition:
              IpAddress:
                acs:SourceIp:
                - Ref: VpcCidrBlock1Dev
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName1Dev
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName1Dev
                - /*
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - oss_projects-dev_rw_app
            - StackId
            - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: 5c8cbd26-3cb3-4760-a390-5000d71c3b4e
  RamGroup2AppProd:
    Type: ALIYUN::RAM::Group
    Properties:
      Comments: 生产环境程序组
      GroupName:
        Ref: GroupName2AppProd
      Policies:
      - Description: 程序只读访问project-code release目录权限
        PolicyDocument:
          Statement:
          - Action:
            - oss:ListObjects
            Condition:
              StringLike:
                oss:Prefix:
                - Fn::Join:
                  - ''
                  - - Ref: BucketName4CodeFolderName
                    - /*
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName4Code
          - Action:
            - oss:Get*
            - oss:List*
            Condition:
              IpAddress:
                acs:SourceIp:
                - Ref: VpcCidrBlock1Dev
                - Ref: VpcCidrBlock2Prod
                - Ref: VpcCidrBlock3Test
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName4Code
                - /
                - Ref: BucketName4CodeFolderName
                - /*
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - oss_projects-code_release_r_app_prod
            - StackId
            - Ref: ALIYUN::StackId
      - Description: '生产环境读写访问bucket projects-prod权限 '
        PolicyDocument:
          Statement:
          - Action:
            - oss:PutObject
            - oss:GetObject
            Condition:
              IpAddress:
                acs:SourceIp:
                - Ref: VpcCidrBlock2Prod
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName2Prod
                - /*
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName2Prod
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - oss_projects-prod_rw_app
            - StackId
            - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: 280a9130-ade1-4909-85f8-6a8ca41bef89
  RamGroup3AppTest:
    Type: ALIYUN::RAM::Group
    Properties:
      Comments: 测试环境程序组
      GroupName:
        Ref: GroupName3AppTest
      Policies:
      - Description: 程序只读访问project-code release目录权限
        PolicyDocument:
          Statement:
          - Action:
            - oss:ListObjects
            Condition:
              StringLike:
                oss:Prefix:
                  Fn::Join:
                  - ''
                  - - Ref: BucketName4CodeFolderName
                    - /*
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName4Code
          - Action:
            - oss:Get*
            - oss:List*
            Condition:
              IpAddress:
                acs:SourceIp:
                - Ref: VpcCidrBlock1Dev
                - Ref: VpcCidrBlock2Prod
                - Ref: VpcCidrBlock3Test
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName4Code
                - /
                - Ref: BucketName4CodeFolderName
                - /*
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - oss_projects-code_release_r_app_test
            - StackId
            - Ref: ALIYUN::StackId
      - Description: 测试环境读写访问bucket projects-test权限
        PolicyDocument:
          Statement:
          - Action:
            - oss:PutObject
            - oss:GetObject
            Condition:
              IpAddress:
                acs:SourceIp:
                - Ref: VpcCidrBlock3Test
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName3Test
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName3Test
                - /*
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - oss_projects-test_rw_app
            - StackId
            - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: d561f103-baae-4a30-9482-d51f0b4362bc
  RamGroup4Sa:
    Type: ALIYUN::RAM::Group
    Properties:
      Comments: 运维组
      GroupName:
        Ref: GroupName4Sa
      Policies:
      - Description: 管理所有阿里云资源的权限
        PolicyDocument:
          Statement:
          - Action:
            - '*'
            Effect: Allow
            Resource:
            - '*'
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - AdministratorAccess_Sa
            - StackId
            - Ref: ALIYUN::StackId
      - Description: 没有RAM管理权限
        PolicyDocument:
          Statement:
          - Action:
            - ram:*
            Effect: Deny
            Resource:
            - '*'
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - deny_ram_sa
            - StackId
            - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: acb066bb-12ff-4546-8dcc-7001595cc7fe
  RamGroup5Dev:
    Type: ALIYUN::RAM::Group
    Properties:
      Comments: 开发组
      GroupName:
        Ref: GroupName5Dev
      Policies:
      - Description: 只读访问所有阿里云资源的权限
        PolicyDocument:
          Statement:
          - Action:
            - '*:Describe*'
            - '*:List*'
            - '*:Get*'
            - '*:BatchGet*'
            - '*:Query*'
            - '*:BatchQuery*'
            - actiontrail:LookupEvents
            - dm:Desc*
            - dm:SenderStatistics*
            - ram:GenerateCredentialReport
            Effect: Allow
            Resource:
            - '*'
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - ReadOnlyAccess_Dev
            - StackId
            - Ref: ALIYUN::StackId
      - Description: project-code读写权限
        PolicyDocument:
          Statement:
          - Action:
            - oss:ListBuckets
            - oss:GetBucket*
            Effect: Allow
            Resource:
            - acs:oss:*:*:*
          - Action:
            - oss:*
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName4Code
                - /*
          - Action:
            - oss:ListObjects
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName4Code
                - /*
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - oss_projects-code_release_rw_dev
            - StackId
            - Ref: ALIYUN::StackId
      - Description: projects-dev完全控制权限
        PolicyDocument:
          Statement:
          - Action:
            - oss:ListBuckets
            - oss:GetBucket*
            Effect: Allow
            Resource:
            - acs:oss:*:*:*
          - Action:
            - oss:*
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName1Dev
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName1Dev
                - /*
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - oss_projects-dev_all
            - StackId
            - Ref: ALIYUN::StackId
      - Description: ECS实例重启权限
        PolicyDocument:
          Statement:
          - Action:
            - ecs:RebootInstance
            Effect: Allow
            Resource:
            - '*'
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - ecs_instance_reboot_Dev
            - StackId
            - Ref: ALIYUN::StackId
      - Description: CDN预热及刷新权限
        PolicyDocument:
          Statement:
          - Action:
            - cdn:PushObjectCache
            - cdn:RefreshObjectCaches
            Effect: Allow
            Resource:
            - '*'
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - cdn_push_refresh_cache_Dev
            - StackId
            - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: 4b361ff5-7af7-4b31-83ea-47e20710144e
  RamGroup6Test:
    Type: ALIYUN::RAM::Group
    Properties:
      Comments: 测试组
      GroupName:
        Ref: GroupName6Test
      Policies:
      - Description: 只读访问所有阿里云资源的权限
        PolicyDocument:
          Statement:
          - Action:
            - '*:Describe*'
            - '*:List*'
            - '*:Get*'
            - '*:BatchGet*'
            - '*:Query*'
            - '*:BatchQuery*'
            - actiontrail:LookupEvents
            - dm:Desc*
            - dm:SenderStatistics*
            - ram:GenerateCredentialReport
            Effect: Allow
            Resource:
            - '*'
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - ReadOnlyAccess_Test
            - StackId
            - Ref: ALIYUN::StackId
      - Description: ECS实例重启权限
        PolicyDocument:
          Statement:
          - Action:
            - ecs:RebootInstance
            Effect: Allow
            Resource:
            - '*'
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - ecs_instance_reboot_Test
            - StackId
            - Ref: ALIYUN::StackId
      - Description: CDN预热及刷新权限
        PolicyDocument:
          Statement:
          - Action:
            - cdn:PushObjectCache
            - cdn:RefreshObjectCaches
            Effect: Allow
            Resource:
            - '*'
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - cdn_push_refresh_cache_Test
            - StackId
            - Ref: ALIYUN::StackId
      - Description: projects-code下release目录只读权限
        PolicyDocument:
          Statement:
          - Action:
            - oss:ListBuckets
            - oss:GetBucket*
            Effect: Allow
            Resource:
            - acs:oss:*:*:*
          - Action:
            - oss:Get*
            - oss:List*
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName4Code
                - /
                - Ref: BucketName4CodeFolderName
                - /*
          - Action:
            - oss:ListObjects
            Condition:
              StringLike:
                oss:Delimiter: /
                oss:Prefix:
                - ''
                - Fn::Join:
                  - ''
                  - - Ref: BucketName4CodeFolderName
                    - /*
                - Fn::Join:
                  - ''
                  - - Ref: BucketName4CodeFolderName
                    - /
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName4Code
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - oss_projects-code_release_r_test
            - StackId
            - Ref: ALIYUN::StackId
      - Description: projects-test完全控制权限
        PolicyDocument:
          Statement:
          - Action:
            - oss:ListBuckets
            - oss:GetBucket*
            Effect: Allow
            Resource:
            - acs:oss:*:*:*
          - Action:
            - oss:*
            Effect: Allow
            Resource:
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName3Test
                - /*
            - Fn::Join:
              - ''
              - - 'acs:oss:*:*:'
                - Ref: BucketName3Test
          Version: '1'
        PolicyName:
          Fn::Join:
          - '-'
          - - oss_projects-test_all
            - StackId
            - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: 4541e5be-eb8a-4b67-a60a-4fe14138e693
  RdsDBInstance:
    Type: ALIYUN::RDS::DBInstance
    Properties:
      VpcId:
        Ref: EcsVpc1Dev
      VSwitchId:
        Ref: EcsVSwitch1Dev
      DBInstanceClass:
        Ref: DBInstanceClass
      DBInstanceNetType: Intranet
      DBInstanceStorage:
        Ref: DBInstanceStorage
      Engine:
        Fn::Select:
        - '0'
        - Fn::Split:
          - '-'
          - Ref: DBInstanceEngineAndVersion
      EngineVersion:
        Fn::Select:
        - '1'
        - Fn::Split:
          - '-'
          - Ref: DBInstanceEngineAndVersion
      PayType: Postpaid
      ResourceGroupId:
        Ref: ResourceGroupId1Dev
      SecurityIPList: 0.0.0.0/0
      Tags:
        key: best_practice
        value: '051'
    Metadata:
      ALIYUN::ROS::Designer:
        id: 4a59c510-563e-411f-8c5b-93c27a568892
  RosWaitConditionHandle:
    Type: ALIYUN::ROS::WaitConditionHandle
    Properties: {}
    Metadata:
      ALIYUN::ROS::Designer:
        id: 5de917c5-e969-4e25-8860-7ade16cdcd40
  RosWaitCondition:
    Type: ALIYUN::ROS::WaitCondition
    Properties:
      Count: 1
      Handle:
        Ref: RosWaitConditionHandle
      Timeout: 600
    Metadata:
      ALIYUN::ROS::Designer:
        id: e33a0374-047f-4446-8e93-38608ada9f5a
  User1ToGroupDev:
    Type: ALIYUN::RAM::UserToGroupAddition
    Properties:
      GroupName:
        Ref: RamGroup5Dev
      Users:
      - Ref: RamUser1Dev
    DependsOn:
    - RamGroup5Dev
    - RamUser1Dev
    Metadata:
      ALIYUN::ROS::Designer:
        id: dbb7d978-b2c5-48ec-a9d5-a5832fa3afaf
  User2ToGroupTest:
    Type: ALIYUN::RAM::UserToGroupAddition
    Properties:
      GroupName:
        Ref: RamGroup4Sa
      Users:
      - Ref: RamUser2Prod
    DependsOn:
    - RamGroup4Sa
    - RamUser2Prod
    Metadata:
      ALIYUN::ROS::Designer:
        id: b841d59a-f1fb-479a-8aed-959897fdb108
  User3ToGroupSa:
    Type: ALIYUN::RAM::UserToGroupAddition
    Properties:
      GroupName:
        Ref: RamGroup6Test
      Users:
      - Ref: RamUser3Test
    DependsOn:
    - RamGroup6Test
    - RamUser3Test
    Metadata:
      ALIYUN::ROS::Designer:
        id: 3db462e0-1fd5-419b-8873-14fdfef1998c
Outputs:
  AccessKeyId1Dev:
    Description:
      en: Develop user group user account AK Id.
      zh-cn: 开发用户组用户帐号AK Id。
    Value:
      Fn::GetAtt:
      - RamAccessKey1Dev
      - AccessKeyId
  AccessKeyId2Prod:
    Description:
      en: Production user group user account AK Id.
      zh-cn: 生产用户组用户帐号AK Id。
    Value:
      Fn::GetAtt:
      - RamAccessKey2Prod
      - AccessKeyId
  AccessKeyId3Test:
    Description:
      en: Test user group user account AK Id.
      zh-cn: 测试用户组用户帐号AK Id。
    Value:
      Fn::GetAtt:
      - RamAccessKey3Test
      - AccessKeyId
  AccessKeySecret1Dev:
    Description:
      en: Develop user group user account AK Secret.
      zh-cn: 开发用户组用户帐号AK Secret。
    Value:
      Fn::GetAtt:
      - RamAccessKey1Dev
      - AccessKeySecret
  AccessKeySecret2Prod:
    Description:
      en: Production user group user account AK Secret.
      zh-cn: 生产用户组用户帐号AK Secret。
    Value:
      Fn::GetAtt:
      - RamAccessKey2Prod
      - AccessKeySecret
  AccessKeySecret3Test:
    Description:
      en: Test user group user account AK Secret.
      zh-cn: 测试用户组用户帐号AK Secret。
    Value:
      Fn::GetAtt:
      - RamAccessKey3Test
      - AccessKeySecret
Metadata:
  ALIYUN::ROS::Interface:
    ParameterGroups:
    - Parameters:
      - ResourceGroupId1Dev
      - ResourceGroupId2Prod
      - ResourceGroupId3Test
      Label:
        default: RESOURCE
    - Parameters:
      - VpcCidrBlock1Dev
      - VpcCidrBlock2Prod
      - VpcCidrBlock3Test
      - VSwitchZoneId
      - VSwitchCidrBlockDev
      - VSwitchCidrBlockProd
      - VSwitchCidrBlockTest
      Label:
        default: VPC
    - Parameters:
      - EcsInstanceType
      - EcsImageId
      - EcsSystemDiskCategory
      - EcsGroupSystemDiskSize
      - EcsPassword
      Label:
        default: ECS
    - Parameters:
      - DBInstanceEngineAndVersion
      - DBInstanceClass
      - DBInstanceStorage
      Label:
        default: RDS
    - Parameters:
      - BucketAccessControl
      - BucketStorageClass
      - BucketName1Dev
      - BucketName2Prod
      - BucketName3Test
      - BucketName4Code
      - BucketName5Other
      - BucketName4CodeFolderName
      - BucketName5CodeFolderName
      Label:
        default: OSS
    - Parameters:
      - GroupName4Sa
      - GroupName5Dev
      - GroupName6Test
      - GroupName1AppDev
      - GroupName2AppProd
      - GroupName3AppTest
      - UserName1Dev
      - UserName2Prod
      - UserName3Test
      Label:
        default: RAM
    TemplateTags:
    - acs:solution:安全&合规:RAM账号权限管理
  ALIYUN::ROS::Designer:
    0788d403-bf08-4f0c-a3ab-63ac9f785e97:
      source:
        id: acb066bb-12ff-4546-8dcc-7001595cc7fe
      target:
        id: b841d59a-f1fb-479a-8aed-959897fdb108
      z: 1
    097c50f2-9a75-4da8-b255-d4666e1a3df1:
      embeds:
      - 5df8cc6d-0d20-4b84-969d-6ca110774eb2
      - 8c5dac94-b362-4011-948c-6ad3a3abcaac
      position:
        x: 13
        y: 127
      size:
        height: 237
        width: 339.1865234375
      z: 0
    0dbeb94e-47e9-4afc-bf4c-b5d62961a7dc:
      source:
        id: 4541e5be-eb8a-4b67-a60a-4fe14138e693
      target:
        id: 3db462e0-1fd5-419b-8873-14fdfef1998c
      z: 1
    1ab08305-fbed-4304-a9b7-c5e2596de46b:
      position:
        x: 539
        y: 267
      size:
        height: 60
        width: 60
      z: 0
    2711c319-d467-49a9-91fe-0f8fdfe2ca6f:
      source:
        id: aab44ffa-a7a5-4bd8-898c-852111f32ef5
      target:
        id: 7deb0cd2-4c08-4cde-9794-928907016062
      z: 1
    280a9130-ade1-4909-85f8-6a8ca41bef89:
      position:
        x: -91
        y: 213
      size:
        height: 60
        width: 60
      z: 0
    2d40b6f2-2d64-445a-b442-f1da03b1dc19:
      position:
        x: -88
        y: 93
      size:
        height: 60
        width: 60
      z: 0
    32dc6a4d-439c-47ca-8031-fb235a7ae2b8:
      source:
        id: 1ab08305-fbed-4304-a9b7-c5e2596de46b
      target:
        id: 3c816a38-a719-44d7-bd58-fd6712f2767e
      z: 1
    33814cb2-7d10-435b-9a06-84672f2bdbef:
      source:
        id: b0500ea3-d883-4eb4-97f0-3d72f7a946f0
      target:
        id: a032374f-7bf5-4eab-8665-7e29f3ab9ff6
      z: 1
    3c816a38-a719-44d7-bd58-fd6712f2767e:
      position:
        x: 698
        y: 267
      size:
        height: 60
        width: 60
      z: 0
    3db462e0-1fd5-419b-8873-14fdfef1998c:
      position:
        x: 538
        y: -99
      size:
        height: 60
        width: 60
      z: 0
    4541e5be-eb8a-4b67-a60a-4fe14138e693:
      position:
        x: 388
        y: -99
      size:
        height: 60
        width: 60
      z: 0
    4a59c510-563e-411f-8c5b-93c27a568892:
      position:
        x: 72
        y: 547
      size:
        height: 60
        width: 60
      z: 2
    4af005c9-e875-48b3-b41e-62bdf9ad2c55:
      source:
        id: aca9826b-7f95-439f-a237-76ab291f0118
      target:
        id: aab44ffa-a7a5-4bd8-898c-852111f32ef5
      z: 1
    4b361ff5-7af7-4b31-83ea-47e20710144e:
      position:
        x: 384
        y: 432
      size:
        height: 60
        width: 60
      z: 0
    5c8cbd26-3cb3-4760-a390-5000d71c3b4e:
      position:
        x: -93
        y: 485
      size:
        height: 60
        width: 60
      z: 0
    5de917c5-e969-4e25-8860-7ade16cdcd40:
      position:
        x: 252
        y: 665
      size:
        height: 60
        width: 60
      z: 0
    5df8cc6d-0d20-4b84-969d-6ca110774eb2:
      embeds:
      - 783320d2-9319-4f8d-adc6-4ef8776d2f45
      position:
        x: 27
        y: 178
      size:
        height: 167
        width: 162.021484375
      z: 1
    6b185598-0614-49f2-8ac6-76c4552592d0:
      embeds:
      - 8b6fcb8c-8354-42b5-bf9a-162f248ebb37
      - a032374f-7bf5-4eab-8665-7e29f3ab9ff6
      position:
        x: 12
        y: -126
      size:
        height: 225
        width: 340.4287109375
      z: 0
    737eccaa-cb07-482e-92e2-66919b57467b:
      position:
        x: 538
        y: 12
      size:
        height: 60
        width: 60
      z: 0
    783320d2-9319-4f8d-adc6-4ef8776d2f45:
      position:
        x: 71
        y: 223
      size:
        height: 60
        width: 60
      z: 2
    794bd95b-525f-4fda-8fae-875ce12842d7:
      embeds:
      - 862da07d-7b3c-4e05-9843-624a3c711269
      - 4a59c510-563e-411f-8c5b-93c27a568892
      position:
        x: 32
        y: 423
      size:
        height: 226
        width: 158
      z: 1
    7deb0cd2-4c08-4cde-9794-928907016062:
      position:
        x: 697
        y: 567
      size:
        height: 60
        width: 60
      z: 0
    862da07d-7b3c-4e05-9843-624a3c711269:
      position:
        x: 70
        y: 457
      size:
        height: 60
        width: 60
      z: 2
    8b6fcb8c-8354-42b5-bf9a-162f248ebb37:
      embeds:
      - b0500ea3-d883-4eb4-97f0-3d72f7a946f0
      position:
        x: 30
        y: -79
      size:
        height: 163
        width: 149.505859375
      z: 1
    8c5dac94-b362-4011-948c-6ad3a3abcaac:
      position:
        x: 250
        y: 223
      size:
        height: 60
        width: 60
      z: 1
    9194776f-fa63-45d6-8d72-8775d6b25f9e:
      source:
        id: ce72a34a-f0ce-48ab-ba68-e830f785c75d
      target:
        id: 1ab08305-fbed-4304-a9b7-c5e2596de46b
      z: 1
    92e60877-4dc5-4ae2-8df2-f8ddc427adde:
      source:
        id: 3db462e0-1fd5-419b-8873-14fdfef1998c
      target:
        id: 737eccaa-cb07-482e-92e2-66919b57467b
      z: 1
    9a7694d5-d9b3-4f4c-a956-f08ca89a0e4b:
      source:
        id: b841d59a-f1fb-479a-8aed-959897fdb108
      target:
        id: 1ab08305-fbed-4304-a9b7-c5e2596de46b
      z: 1
    a032374f-7bf5-4eab-8665-7e29f3ab9ff6:
      position:
        x: 247
        y: -38
      size:
        height: 60
        width: 60
      z: 1
    a2a3c7fb-577d-4605-8560-7268dcb0d910:
      source:
        id: ca7d5e0d-57a8-48c4-a57e-baba40f1f349
      target:
        id: 737eccaa-cb07-482e-92e2-66919b57467b
      z: 1
    aab44ffa-a7a5-4bd8-898c-852111f32ef5:
      position:
        x: 535
        y: 566
      size:
        height: 60
        width: 60
      z: 0
    aca9826b-7f95-439f-a237-76ab291f0118:
      position:
        x: 388
        y: 566
      size:
        height: 60
        width: 60
      z: 0
    acb066bb-12ff-4546-8dcc-7001595cc7fe:
      position:
        x: 387
        y: 157
      size:
        height: 60
        width: 60
      z: 0
    ad3fab44-369c-4312-9b35-e2268401f9b5:
      source:
        id: 4b361ff5-7af7-4b31-83ea-47e20710144e
      target:
        id: dbb7d978-b2c5-48ec-a9d5-a5832fa3afaf
      z: 1
    b0500ea3-d883-4eb4-97f0-3d72f7a946f0:
      position:
        x: 68
        y: -38
      size:
        height: 60
        width: 60
      z: 2
    b2e860ba-7728-4eb6-8541-53d8773224b0:
      source:
        id: 862da07d-7b3c-4e05-9843-624a3c711269
      target:
        id: e66ecbac-da4a-44f2-b74e-c47dd3d88f53
      z: 1
    b841d59a-f1fb-479a-8aed-959897fdb108:
      position:
        x: 539
        y: 157
      size:
        height: 60
        width: 60
      z: 0
    bd950d39-dae1-4d31-a98d-11d182a363e5:
      source:
        id: dbb7d978-b2c5-48ec-a9d5-a5832fa3afaf
      target:
        id: aab44ffa-a7a5-4bd8-898c-852111f32ef5
      z: 1
    ca7d5e0d-57a8-48c4-a57e-baba40f1f349:
      position:
        x: 385
        y: 12
      size:
        height: 60
        width: 60
      z: 0
    ce657371-5d20-4779-9d6d-21a4c7b627d2:
      embeds:
      - 794bd95b-525f-4fda-8fae-875ce12842d7
      - e66ecbac-da4a-44f2-b74e-c47dd3d88f53
      position:
        x: 12
        y: 393
      size:
        height: 266
        width: 338.6962890625
      z: 0
    ce72a34a-f0ce-48ab-ba68-e830f785c75d:
      position:
        x: 387
        y: 267
      size:
        height: 60
        width: 60
      z: 0
    d006d522-7912-414d-b6b1-9f0b4a945027:
      source:
        id: 783320d2-9319-4f8d-adc6-4ef8776d2f45
      target:
        id: 8c5dac94-b362-4011-948c-6ad3a3abcaac
      z: 1
    d4085be3-0c4d-42f0-b85f-437bdf0eeb6c:
      position:
        x: 686
        y: -104
      size:
        height: 60
        width: 60
      z: 0
    d561f103-baae-4a30-9482-d51f0b4362bc:
      position:
        x: -87
        y: -48
      size:
        height: 60
        width: 60
      z: 0
    d9fb59df-e552-4fa1-a5d8-bff3c30303fa:
      position:
        x: -90
        y: 354
      size:
        height: 60
        width: 60
      z: 0
    db71df8f-1ae3-44ef-bff7-c6fa66f75051:
      source:
        id: e33a0374-047f-4446-8e93-38608ada9f5a
      target:
        id: 5de917c5-e969-4e25-8860-7ade16cdcd40
      z: 1
    dbb7d978-b2c5-48ec-a9d5-a5832fa3afaf:
      position:
        x: 535
        y: 432
      size:
        height: 60
        width: 60
      z: 0
    e33a0374-047f-4446-8e93-38608ada9f5a:
      position:
        x: 67
        y: 666
      size:
        height: 60
        width: 60
      z: 0
    e36dbde3-140d-41fc-af8b-07973e109f58:
      source:
        id: 737eccaa-cb07-482e-92e2-66919b57467b
      target:
        id: fa32432b-b74c-4052-b9b9-dce65dc19be9
      z: 1
    e66ecbac-da4a-44f2-b74e-c47dd3d88f53:
      position:
        x: 252
        y: 457
      size:
        height: 60
        width: 60
      z: 1
    f8d2aa33-0494-4a8d-9d45-3af90273961d:
      position:
        x: 690
        y: 159
      size:
        height: 60
        width: 60
      z: 0
    fa32432b-b74c-4052-b9b9-dce65dc19be9:
      position:
        x: 692
        y: 12
      size:
        height: 60
        width: 60
      z: 0
    fcc2906e-1b34-4746-9c99-979112a0961a:
      position:
        x: 692
        y: 432
      size:
        height: 60
        width: 60
      z: 0
