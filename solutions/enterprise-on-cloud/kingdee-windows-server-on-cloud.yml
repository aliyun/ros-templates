ROSTemplateFormatVersion: '2015-09-01'
Description:
  zh-cn: 单节点实例在新建专有网络模式下部署金蝶云星空7.5企业版应用，使用者需要单独提供金蝶云星空许可、SQLServer许可
  en: Single-node instances deploy Kingdee Cloud Star 7.5 Enterprise applications
    in new proprietary network mode, and users need to provide Kingdee Cloud Star
    License, SQL Server License separately
Parameters:
  VSwitchZoneId:
    Type: String
    Label:
      zh-cn: 交换机可用区
      en: VSwitch Availability Zone
    Description:
      zh-cn: 可用区ID。<br><b>注： <font color='blue'>选择前请确认该可用区是否支持创建ECS资源的规格，建议与其他交换机可用区不同</font></b>
      en: Availability Zone ID.<br><b>note：<font color='blue'>before selecting, please
        confirm that the Availability Zone supports the specification of creating
        ECS resources,which is recommended to be different from other VSwitch Availability
        Zone</font></b>
    AssociationProperty: ALIYUN::ECS::Instance:ZoneId
  InstanceImageId:
    Type: String
    Label:
      zh-cn: ECS镜像ID
      en: ECS Image ID
    Description:
      zh-cn: 请上传自定义镜像，目前该应用适用于非生产环境单机版部署，此自定义镜像需要包含金蝶云星空7.5企业版应用、SQLServer 2016 SP2应用，使用者需要单独提供金蝶云星空许可、SQLServer许可。
      en: Please upload a custom image to the Shenzhen region, the current application
        for non-production environment stand-alone deployment, this custom image includes
        Kingdee Cloud Star 7.5 Enterprise app, SQLServer 2016 SP2 app, users need
        to provide the Kingdee Cloud Star license, SQL Server license separately.
  InstanceType:
    Type: String
    Label:
      zh-cn: 实例规格
      en: Instance Type
    Description:
      zh-cn: 填写VSwitch可用区下可使用的规格；<br>通用规格：<font color='red'><b>ecs.g5.xlarge</b></font><br>注：可用区可能不支持通用规格<br>规格详见：<a
        href='https://help.aliyun.com/document_detail/25378.html' target='_blank'><b><font
        color='blue'>实例规格族</font></a></b>
      en: 'Fill in the specifications that can be used under the VSwitch availability
        zone;</b></font><br>general specifications：<font color=''red''><b>ecs.c5.large</b></font><br>note:
        a few zones do not support general specifications<br>see detail: <a href=''https://www.alibabacloud.com/help/en/doc-detail/25378.html''
        target=''_blank''><b><font color=''blue''>Instance Specification Family</font></a></b>'
    AssociationProperty: ALIYUN::ECS::Instance::InstanceType
    AssociationPropertyMetadata:
      ZoneId: VSwitchZoneId
    Default: ecs.g5.xlarge
  InstancePublicIP:
    Type: Boolean
    Label:
      zh-cn: 分配公网IP
      en: Allocate Public IP
    Description:
      en: Whether to assign a common IP.
      zh-cn: 是否分配公网IP。
    Default: false
  InstanceHostName:
    Type: String
    Label:
      en: ECS Hostname
      zh-cn: ECS主机名
    Description:
      en: The minimum length is 2 characters. English periods (.) and dashes (-) cannot
        be used as the first and last characters of the host name and cannot be used
        continuously, and the maximum length of the <br> Windows platform is 15 characters,
        supporting English letters, numbers, or dashes (-). English periods (.) are
        not supported, they cannot be all numbers, and the maximum length of the <br>
        Linux platform is 30 characters, at intervals between English periods (.),
        each segment consisting of English letters, numbers, and dashes (-).
      zh-cn: 最小长度为2个字符。英文句点（.）和短划线（-）不能作为主机名的首尾字符，且不能连续使用；<br>Windows平台最大长度为15个字符，支持英文字母、数字或短划线（-）。不支持英文句点（.），不能全是数字；<br>Linux平台最大长度为30个字符，以英文句点（.）间隔，每段可以由英文字母、数字和短划线（-）组成。
    MinLength: 2
    MaxLength: 30
  InstancePassword:
    Type: String
    Label:
      zh-cn: 实例密码
      en: Instance Password
    Description:
      zh-cn: 服务器登录密码,长度8-30，必须包含三项（大写字母、小写字母、数字、 ()`~!@#$%^&*_-+=|{}[]:;'<>,.?/ 中的特殊符号）。
      en: Server login password, Length 8-30, must contain three(Capital letters,
        lowercase letters, numbers, ()`~!@#$%^&*_-+=|{}[]:;'<>,.?/ Special symbol
        in).
    ConstraintDescription:
      zh-cn: 长度8-30，必须包含三项（大写字母、小写字母、数字、 ()`~!@#$%^&*_-+=|{}[]:;'<>,.?/ 中的特殊符号）。
      en: Length 8-30, must contain three(Capital letters, lowercase letters, numbers,
        ()`~!@#$%^&*_-+=|{}[]:;'<>,.?/ Special symbol in).
    AllowedPattern: '[0-9A-Za-z\_\-\&:;''<>,=%`~!@#\(\)\$\^\*\+\|\{\}\[\]\.\?\/]+$'
    MinLength: 8
    MaxLength: 30
    NoEcho: true
    Confirm: true
  SystemDiskSize:
    Type: Number
    Label:
      zh-cn: 系统盘空间
      en: System Disk Space
    Description:
      zh-cn: 系统盘大小, 取值范围：[100, 500], 单位：GB。
      en: 'System disk size, range of values: 100-500, units: GB.'
    Default: 100
  SystemDiskCategory:
    Type: String
    Label:
      en: System Disk Type
      zh-cn: 系统盘类型
    Description:
      en: '<font color=''blue''><b>Optional values:</b></font><br>[cloud_efficiency:
        <font color=''green''>Efficient Cloud Disk</font>]<br>[cloud_ssd: <font color=''green''>SSD
        Cloud Disk</font>]<br>[cloud_essd: <font color=''green''>ESSD Cloud Disk</font>]<br>[cloud:
        <font color=''green''>Cloud Disk</font>]<br>[ephemeral_ssd: <font color=''green''>Local
        SSD Cloud Disk</font>]'
      zh-cn: '<font color=''blue''><b>可选值：</b></font><br>[cloud_efficiency: <font
        color=''green''>高效云盘</font>]<br>[cloud_ssd: <font color=''green''>SSD云盘</font>]<br>[cloud_essd:
        <font color=''green''>ESSD云盘</font>]<br>[cloud: <font color=''green''>普通云盘</font>]<br>[ephemeral_ssd:
        <font color=''green''>本地SSD盘</font>]'
    Default: cloud_efficiency
    AllowedValues:
    - cloud_efficiency
    - cloud_ssd
    - cloud
    - cloud_essd
    - ephemeral_ssd
Resources:
  EcsVpc:
    Type: ALIYUN::ECS::VPC
    Properties:
      CidrBlock: 192.168.0.0/16
      VpcName:
        Fn::Join:
        - '-'
        - - StackId
          - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: 92c6daaa-0978-4925-bb6b-188340507d5c
  EcsSecurityGroup:
    Type: ALIYUN::ECS::SecurityGroup
    Properties:
      VpcId:
        Ref: EcsVpc
      SecurityGroupIngress:
      - PortRange: -1/-1
        Priority: 1
        SourceCidrIp: 0.0.0.0/0
        IpProtocol: all
        NicType: intranet
      SecurityGroupEgress:
      - PortRange: -1/-1
        Priority: 1
        IpProtocol: all
        DestCidrIp: 0.0.0.0/0
        NicType: intranet
    Metadata:
      ALIYUN::ROS::Designer:
        id: c8c8e38d-cf9a-4023-92f4-b0df10654e28
  EcsVSwitch:
    Type: ALIYUN::ECS::VSwitch
    Properties:
      ZoneId:
        Ref: VSwitchZoneId
      VpcId:
        Ref: EcsVpc
      CidrBlock: 192.168.0.0/24
    Metadata:
      ALIYUN::ROS::Designer:
        id: c53d1e62-1f8d-4a15-962e-49ebe0deab92
  KingSeeServer:
    Type: ALIYUN::ECS::Instance
    Properties:
      VpcId:
        Ref: EcsVpc
      VSwitchId:
        Ref: EcsVSwitch
      SecurityGroupId:
        Ref: EcsSecurityGroup
      ImageId:
        Ref: InstanceImageId
      IoOptimized: optimized
      AllocatePublicIP:
        Ref: InstancePublicIP
      InstanceType:
        Ref: InstanceType
      SystemDiskCategory:
        Ref: SystemDiskCategory
      SystemDiskSize:
        Ref: SystemDiskSize
      Password:
        Ref: InstancePassword
      HostName:
        Ref: InstanceHostName
    Metadata:
      ALIYUN::ROS::Designer:
        id: acec6d25-1a3d-4305-bb5c-45c6858aaa70
Outputs:
  EcsInstanceId:
    Value:
      Fn::GetAtt:
      - KingSeeServer
      - InstanceId
  EcsPrivateIp:
    Value:
      Fn::GetAtt:
      - KingSeeServer
      - PrivateIp
  EcsHostName:
    Value:
      Fn::GetAtt:
      - KingSeeServer
      - HostName
Metadata:
  ALIYUN::ROS::Interface:
    ParameterGroups:
    - Parameters:
      - VSwitchZoneId
      - InstanceImageId
      - InstanceType
      - InstancePublicIP
      - InstanceHostName
      - InstancePassword
      - SystemDiskSize
      - SystemDiskCategory
      Label:
        default:
          zh-cn: 金蝶主机配置
          en: KingdeeServer Configuration
    TemplateTags:
    - acs:solution:企业软件上云:金蝶云星空应用部署上云(新建专有网络)-单机服务器部署
  ALIYUN::ROS::Designer:
    92c6daaa-0978-4925-bb6b-188340507d5c:
      size:
        width: 486.5244140625
        height: 344
      position:
        x: 485
        y: 205
      z: 0
      embeds:
      - c8c8e38d-cf9a-4023-92f4-b0df10654e28
      - c53d1e62-1f8d-4a15-962e-49ebe0deab92
    c53d1e62-1f8d-4a15-962e-49ebe0deab92:
      size:
        width: 171
        height: 180
      position:
        x: 544
        y: 279
      z: 1
      embeds:
      - acec6d25-1a3d-4305-bb5c-45c6858aaa70
    acec6d25-1a3d-4305-bb5c-45c6858aaa70:
      size:
        width: 60
        height: 60
      position:
        x: 601
        y: 341
      z: 2
    c8c8e38d-cf9a-4023-92f4-b0df10654e28:
      size:
        width: 60
        height: 60
      position:
        x: 860
        y: 341
      z: 1
    8d11b979-5df1-4538-8ab1-5043295900a3:
      source:
        id: acec6d25-1a3d-4305-bb5c-45c6858aaa70
      target:
        id: c8c8e38d-cf9a-4023-92f4-b0df10654e28
      z: 1
