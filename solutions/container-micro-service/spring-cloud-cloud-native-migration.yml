ROSTemplateFormatVersion: '2015-09-01'
Description:
  zh-cn: 基于现有VPC和安全组，使用ROS模版部署ECS、ACK托管版，配置Eureka、Gateway及K8s服务，实现Spring Cloud应用的快速搭建与迁移，含负载均衡和自动扩展功能。
  en: Deploy ECS and managed ACK (Alibaba Cloud Container Service for Kubernetes)
    using ROS (Resource Orchestration Service) templates based on the existing VPC
    and security groups, with configurations for Eureka, Gateway, and Kubernetes services,
    to facilitate rapid setup and migration of Spring Cloud applications. This setup
    includes load balancing and auto-scaling capabilities.
Conditions:
  NoStandbyEureka:
    Fn::Equals:
    - Ref: StandbyEurekaInstanceTypes
    - default
  NoStandbyGateway:
    Fn::Equals:
    - Ref: StandbyGatewayInstanceTypes
    - default
  NoStandbyK8s:
    Fn::Equals:
    - Ref: StandbyK8sInstanceTypes
    - default
Parameters:
  VpcId:
    Type: String
    Label:
      en: Existing VPC Instance ID
      zh-cn: 现有VPC的实例ID
    Description:
      en: Please search the ID starting with (vpc-xxx)from console-Virtual Private
        Cloud
      zh-cn: 控制台-VPC-专有网络下查询
    AssociationProperty: ALIYUN::ECS::VPC::VPCId
  SecurityGroupId:
    Type: String
    Label:
      en: Business Security Group ID
      zh-cn: 业务安全组ID
    Description:
      en: Please search the business security group ID starting with(sg-xxx)from console-ECS-Network
        & Security
      zh-cn: 现有业务安全组的实例ID,控制台-ECS-网络与安全-安全组下查询
    AssociationProperty: ALIYUN::ECS::SecurityGroup::SecurityGroupId
    AssociationPropertyMetadata:
      VpcId: VpcId
  VSwitchIds:
    Type: String
    Label:
      en: VSwitch IDs
      zh-cn: 网络交换机ID
    Description:
      en: 'Instance ID of existing service network switch, query under console -VPC
        -proprietary network -switch; Multiple switches are separated by English commas
        (,).<br><font color=''blue''><b>Note: By default, resources will be created
        under each switch, including: Eureka/Gateway Server, SLB(For Eureka), Container
        Worker Node</b></font><br>Fill in at least 2, fill in a maximum of 3, and
        recommend filling in 3 exchange IDs for different Availability Zones.<br>Example：
        vsw-xxxxxxxx,vsw-xxxxxxxx,vsw-xxxxxxxx'
      zh-cn: 现有业务网络交换机的实例ID,控制台-VPC-专有网络-交换机下查询；多个交换机使用英文逗号（,）分割。<br><font color='blue'><b>注：默认会在每个交换机下创建资源，资源包含：
        Eureka/Gateway Server、SLB（用于Eureka）、容器Worker Node</b></font><br>至少填写2个, 最大填写3个，建议填写3个不同可用区的交换ID。<br>示例：
        vsw-xxxxxxxx,vsw-xxxxxxxx,vsw-xxxxxxxx
  Port:
    Type: Number
    Label:
      en: Service Port
      zh-cn: 服务端口
    Description:
      en: Spring Cloud service port, Please use the port number in the range 1024-65535.
      zh-cn: Spring Cloud服务端口，请使用1024-65535范围内端口号。
    Default: 8081
    MinValue: 1024
    MaxValue: 65535
  InstanceImageId:
    Type: String
    Label:
      en: Image ID
      zh-cn: 镜像ID
    Description:
      en: 'Image ID，See detail：<b><a href=''https://www.alibabacloud.com/help/doc-detail/112977.html''
        target=''_blank''><font color=''blue''>Find the mirror</font></a></b><br><font
        color=''blue''><b>Note: Use CentOS to install Aliyun-CLI, JDK and other dependencies
        on the server by default; CentOS images are recommended.</font></b>'
      zh-cn: 镜像ID, 详见：<b><a href='https://help.aliyun.com/document_detail/112977.html'
        target='_blank'><font color='blue'>查找镜像</font></a></b><br><font color='blue'><b>注：
        使用CentOS默认在服务器上安装Aliyun-CLI、JDK等相关依赖； 推荐使用CentOS镜像。</font></b>
    AssociationProperty: ALIYUN::ECS::Instance::ImageId
    Default: centos_7_06_64_20G_alibase_20190711.vhd
  InstancePassword:
    Type: String
    Label:
      en: Instance Password
      zh-cn: 实例密码
    Description:
      en: Server login password, Length 8-30, must contain three(Capital letters,
        lowercase letters, numbers, ()`~!@#$%^&*_-+=|{}[]:;'<>,.?/ Special symbol
        in)
      zh-cn: 服务器登录密码,长度8-30，必须包含三项（大写字母、小写字母、数字、 ()`~!@#$%^&*_-+=|{}[]:;'<>,.?/ 中的特殊符号）
    ConstraintDescription:
      en: Length 8-30, must contain three(Capital letters, lowercase letters, numbers,
        ()`~!@#$%^&*_-+=|{}[]:;'<>,.?/ Special symbol in).
      zh-cn: 长度8-30，必须包含三项（大写字母、小写字母、数字、 ()`~!@#$%^&*_-+=|{}[]:;'<>,.?/ 中的特殊符号）。
    AllowedPattern: '[0-9A-Za-z\_\-\&:;''<>,=%`~!@#\(\)\$\^\*\+\|\{\}\[\]\.\?\/]+$'
    MinLength: 8
    MaxLength: 30
    NoEcho: true
  EurekaSlbSpec:
    Type: String
    Label:
      en: Eureka SLB Specification
      zh-cn: Eureka SLB规格
    Description:
      en: Instance specifications, see detail：</b><a href='https://www.alibabacloud.com/help/doc-detail/85939.html'
        target='_blank'><b><font color='blue'>Performance Support Type</b></font></a>
      zh-cn: 实例规格，详见：</b><a href='https://help.aliyun.com/document_detail/85939.html'
        target='_blank'><b><font color='blue'>性能保障型</b></font></a>
    AllowedValues:
    - slb.s1.small
    - slb.s2.small
    - slb.s2.medium
    - slb.s3.small
    - slb.s3.medium
    - slb.s3.large
  EurekaInstanceType:
    Type: String
    Label:
      en: Instance Main Type
      zh-cn: 实例主规格
    Description:
      en: <font color='blue'><b>1.Before selecting the model please confirm that the
        current available zone under the model is in stock, some models need to be
        reported in advance</b></font>]<br><font color='blue'><b>2.List of Recommended
        Models</font><br></b></font>[ecs.c5.large <font color='green'>2vCPU 4GiB Intranet
        bandwidth1Gbps In-grid sending and receiving packages30MillionPPSS</font>]<br></b>[ecs.c5.xlarge
        <font color='green'>4vCPU 8GiB Intranet bandwidth1.5Gbps In-grid sending and
        receiving packages50MillionPPS</font>]<br></b>[ecs.c5.2xlarge <font color='green'>8vCPU
        16GiB Intranet bandwidth2.5Gbps In-grid sending and receiving packages80MillionPPS</font>]
      zh-cn: <font color='blue'><b>1.选择机型前请先确认当前可用区下该机型是否有货，部分机型需要提前报备</b></font><br><font
        color='blue'><b>2.推荐机型列表</font><br></b></font>[ecs.c5.large <font color='green'>2vCPU
        4GiB 内网带宽1Gbps 内网收发包30万PPS</font>]<br></b>[ecs.c5.xlarge <font color='green'>4vCPU
        8GiB 内网带宽1.5Gbps 内网收发包50万PPS</font>]<br></b>[ecs.c5.2xlarge <font color='green'>8vCPU
        16GiB 内网带宽2.5Gbps 内网收发包80万PPS</font>]
    AssociationProperty: ALIYUN::ECS::Instance::InstanceType
  StandbyEurekaInstanceTypes:
    Type: String
    Label:
      en: Instance Alternate Type
      zh-cn: 实例备用规格
    Description:
      en: 'Server spare specifications;Multiple specifications are split using an
        English comma (,).<br><font color=''blue''><b>Note: Server specifications
        take precedence over the main specifications, and alternate specifications
        are lowered in order of elements</b></font><br>The default default indicates
        that there are no alternate specifications and a maximum of 9 are filled in.<br>Example：
        ecs.c6.large,ecs.g6e.large,ecs.g6.large'
      zh-cn: 服务器备用规格；多个规格使用英文逗号（,）分割。<br><font color='blue'><b>注：服务器规格优先使用主规格，备用规格优先级按元素的顺序依次降低</b></font><br>默认default表示没有备用规格，最大填写9个。<br>示例：
        ecs.c6.large,ecs.g6e.large,ecs.g6.large
    Default: default
  EurekaDiskCategory:
    Type: String
    Label:
      en: Disk Type
      zh-cn: 磁盘类型
    Description:
      en: '<font color=''blue''><b>Optional values:</b></font><br>[cloud_efficiency:
        <font color=''green''>Efficient Cloud Disk</font>]<br>[cloud_ssd: <font color=''green''>SSD
        Cloud Disk</font>]<br>[cloud_essd: <font color=''green''>ESSD Cloud Disk</font>]<br>[cloud:
        <font color=''green''>Cloud Disk</font>]<br>[ephemeral_ssd: <font color=''green''>Local
        SSD Cloud Disk</font>]'
      zh-cn: '<font color=''blue''><b>可选值：</b></font><br>[cloud_efficiency: <font
        color=''green''>高效云盘</font>]<br>[cloud_ssd: <font color=''green''>SSD云盘</font>]<br>[cloud_essd:
        <font color=''green''>ESSD云盘</font>]<br>[cloud: <font color=''green''>普通云盘</font>]<br>[ephemeral_ssd:
        <font color=''green''>本地SSD盘</font>]'
    Default: cloud_efficiency
    AllowedValues:
    - cloud_efficiency
    - cloud_ssd
    - cloud
    - cloud_essd
    - ephemeral_ssd
  EurekaSystemDiskSize:
    Type: Number
    Label:
      en: System Disk Space
      zh-cn: 系统盘空间
    Description:
      en: System disk space of Eureka
      zh-cn: Eureka 系统盘空间
    Default: 40
    MinValue: 40
    MaxValue: 2048
  GatewaySlbSpec:
    Type: String
    Label:
      en: Gateway SLB Specification
      zh-cn: Gateway SLB规格
    Description:
      en: Instance specifications, see detail：</b><a href='https://www.alibabacloud.com/help/doc-detail/85939.html'
        target='_blank'><b><font color='blue'>Performance Support Type</b></font></a>
      zh-cn: 实例规格，详见：</b><a href='https://help.aliyun.com/document_detail/85939.html'
        target='_blank'><b><font color='blue'>性能保障型</b></font></a>
    AllowedValues:
    - slb.s1.small
    - slb.s2.small
    - slb.s2.medium
    - slb.s3.small
    - slb.s3.medium
    - slb.s3.large
  GatewayInstanceType:
    Type: String
    Label:
      en: Instance Type
      zh-cn: 实例规格
    Description:
      en: <font color='blue'><b>1.Before selecting the model please confirm that the
        current available zone under the model is in stock, some models need to be
        reported in advance</b></font>]<br><font color='blue'><b>2.List of Recommended
        Models</font><br></b></font>[ecs.c5.large <font color='green'>2vCPU 4GiB Intranet
        bandwidth1Gbps In-grid sending and receiving packages30MillionPPSS</font>]<br></b>[ecs.c5.xlarge
        <font color='green'>4vCPU 8GiB Intranet bandwidth1.5Gbps In-grid sending and
        receiving packages50MillionPPS</font>]<br></b>[ecs.c5.2xlarge <font color='green'>8vCPU
        16GiB Intranet bandwidth2.5Gbps In-grid sending and receiving packages80MillionPPS</font>]
      zh-cn: <font color='blue'><b>1.选择机型前请先确认当前可用区下该机型是否有货，部分机型需要提前报备</b></font><br><font
        color='blue'><b>2.推荐机型列表</font><br></b></font>[ecs.c5.large <font color='green'>2vCPU
        4GiB 内网带宽1Gbps 内网收发包30万PPS</font>]<br></b>[ecs.c5.xlarge <font color='green'>4vCPU
        8GiB 内网带宽1.5Gbps 内网收发包50万PPS</font>]<br></b>[ecs.c5.2xlarge <font color='green'>8vCPU
        16GiB 内网带宽2.5Gbps 内网收发包80万PPS</font>]
    AssociationProperty: ALIYUN::ECS::Instance::InstanceType
  StandbyGatewayInstanceTypes:
    Type: String
    Label:
      en: Instance Alternate Type
      zh-cn: 实例备用规格
    Description:
      en: 'Server spare specifications;Multiple specifications are split using an
        English comma (,).<br><font color=''blue''><b>Note: Server specifications
        take precedence over the main specifications, and alternate specifications
        are lowered in order of elements</b></font><br>The default default indicates
        that there are no alternate specifications and a maximum of 9 are filled in.<br>Example：
        ecs.c6.large,ecs.g6e.large,ecs.g6.large'
      zh-cn: 服务器备用规格；多个规格使用英文逗号（,）分割。<br><font color='blue'><b>注：服务器规格优先使用主规格，备用规格优先级按元素的顺序依次降低</b></font><br>默认default表示没有备用规格，最大填写9个。<br>示例：
        ecs.c6.large,ecs.g6e.large,ecs.g6.large
    Default: default
  GatewayDiskCategory:
    Type: String
    Label:
      en: Disk Type
      zh-cn: 磁盘类型
    Description:
      en: '<font color=''blue''><b>Optional values:</b></font><br>[cloud_efficiency:
        <font color=''green''>Efficient Cloud Disk</font>]<br>[cloud_ssd: <font color=''green''>SSD
        Cloud Disk</font>]<br>[cloud_essd: <font color=''green''>ESSD Cloud Disk</font>]<br>[cloud:
        <font color=''green''>Cloud Disk</font>]<br>[ephemeral_ssd: <font color=''green''>Local
        SSD Cloud Disk</font>]'
      zh-cn: '<font color=''blue''><b>可选值：</b></font><br>[cloud_efficiency: <font
        color=''green''>高效云盘</font>]<br>[cloud_ssd: <font color=''green''>SSD云盘</font>]<br>[cloud_essd:
        <font color=''green''>ESSD云盘</font>]<br>[cloud: <font color=''green''>普通云盘</font>]<br>[ephemeral_ssd:
        <font color=''green''>本地SSD盘</font>]'
    Default: cloud_efficiency
    AllowedValues:
    - cloud_efficiency
    - cloud_ssd
    - cloud
    - cloud_essd
    - ephemeral_ssd
  GatewaySystemDiskSize:
    Type: Number
    Label:
      en: System Disk Space
      zh-cn: 系统盘空间
    Description:
      en: System disk space of Gateway
      zh-cn: Gateway 节点系统盘空间
    Default: 40
    MinValue: 40
    MaxValue: 2048
  K8sVersion:
    Type: String
    Label:
      en: Kubernetes Version
      zh-cn: Kubernetes 版本
    Description:
      en: Kubernetes version
      zh-cn: Kubernetes 版本
    Default: 1.18.8-aliyun.1
    AllowedValues:
    - 1.18.8-aliyun.1
    - 1.16.9-aliyun.1
  K8sInstanceType:
    Type: String
    Label:
      en: Instance Type
      zh-cn: 实例规格
    Description:
      en: <font color='blue'><b>1.Before selecting the model please confirm that the
        current available zone under the model is in stock, some models need to be
        reported in advance</b></font>]<br><font color='blue'><b>2.List of Recommended
        Models</font><br></b></font>[ecs.c5.large <font color='green'>2vCPU 4GiB Intranet
        bandwidth1Gbps In-grid sending and receiving packages30MillionPPSS</font>]<br></b>[ecs.c5.xlarge
        <font color='green'>4vCPU 8GiB Intranet bandwidth1.5Gbps In-grid sending and
        receiving packages50MillionPPS</font>]<br></b>[ecs.c5.2xlarge <font color='green'>8vCPU
        16GiB Intranet bandwidth2.5Gbps In-grid sending and receiving packages80MillionPPS</font>]
      zh-cn: <font color='blue'><b>1.选择机型前请先确认当前可用区下该机型是否有货，部分机型需要提前报备</b></font><br><font
        color='blue'><b>2.推荐机型列表</font><br></b></font>[ecs.c5.large <font color='green'>2vCPU
        4GiB 内网带宽1Gbps 内网收发包30万PPS</font>]<br></b>[ecs.c5.xlarge <font color='green'>4vCPU
        8GiB 内网带宽1.5Gbps 内网收发包50万PPS</font>]<br></b>[ecs.c5.2xlarge <font color='green'>8vCPU
        16GiB 内网带宽2.5Gbps 内网收发包80万PPS</font>]
    AssociationProperty: ALIYUN::ECS::Instance::InstanceType
  StandbyK8sInstanceTypes:
    Type: String
    Label:
      en: Instance Alternate Type
      zh-cn: 实例备用规格
    Description:
      en: 'Server spare specifications;Multiple specifications are split using an
        English comma (,).<br><font color=''blue''><b>Note: Server specifications
        take precedence over the main specifications, and alternate specifications
        are lowered in order of elements</b></font><br>The default default indicates
        that there are no alternate specifications and a maximum of 9 are filled in.<br>Example：
        ecs.c6.large,ecs.g6e.large,ecs.g6.large'
      zh-cn: 服务器备用规格；多个规格使用英文逗号（,）分割。<br><font color='blue'><b>注：服务器规格优先使用主规格，备用规格优先级按元素的顺序依次降低</b></font><br>默认default表示没有备用规格，最大填写9个。<br>示例：
        ecs.c6.large,ecs.g6e.large,ecs.g6.large
    Default: default
  K8sContainerCidr:
    Type: String
    Label:
      en: Pod CIDR network
      zh-cn: Pod网络CIDR
    Description:
      en: 'Please fill in a valid private segment, i.e. the following segments and
        their subnets: 10.0.0.0/8, 172.16-31.0.0/12-16, 192.168.0.0/16<br> cannot
        be associated with the VPC network Segments used by Kubernetes clusters in
        segment 10.0.0.0/8 and VPC are duplicated and cannot be modified after successful
        creation<br>Cluster network planning See: <b><a href=''https://www.alibabacloud.com/help/doc-detail/86500.html''
        target=''_blank''><font color=''blue''>Network address segment planning for
        Kubernetes under VPC.</font></a></b><br>In the current configuration, up to
        1024 hosts can be deployed within the cluster.'
      zh-cn: 请填写有效的私有网段，即以下网段及其子网：10.0.0.0/8，172.16-31.0.0/12-16，192.168.0.0/16<br>不能与
        VPC 网段 10.0.0.0/8 及 VPC 内已有 Kubernetes 集群使用的网段重复，创建成功后不能修改。<br>集群网络规划请参见：<b><a
        href='https://help.aliyun.com/document_detail/86500.html' target='_blank'><font
        color='blue'>VPC下 Kubernetes 的网络地址段规划</font></a></b><br>当前配置下，集群内最多可允许部署 1024
        台主机。
    Default: 172.20.0.0/16
  K8sServiceCidr:
    Type: String
    Label:
      en: Service CIDR
      zh-cn: Service CIDR
    Description:
      en: 'Optional scope: 10.0.0.0/16-24, 172.16-31.0.0/16-24, 192.168.0.0/16-24
        <br>with VPC network segment 10.0.0.0/8 and VPC Kubernetes cluster using segment
        repeat, already in the created cannot be modified after the success.'
      zh-cn: 可选范围：10.0.0.0/16-24，172.16-31.0.0/16-24，192.168.0.0/16-24<br>不能与 VPC
        网段 10.0.0.0/8 及 VPC 内已有 Kubernetes 集群使用的网段重复，创建成功后不能修改。
    Default: 172.21.0.0/20
  K8sDiskCategory:
    Type: String
    Label:
      en: Disk Type
      zh-cn: 磁盘类型
    Description:
      en: '<font color=''blue''><b>Optional values:</b></font><br>[cloud_efficiency:
        <font color=''green''>Efficient Cloud Disk</font>]<br>[cloud_ssd: <font color=''green''>SSD
        Cloud Disk</font>]<br>[cloud_essd: <font color=''green''>ESSD Cloud Disk</font>]<br>[cloud:
        <font color=''green''>Cloud Disk</font>]<br>[ephemeral_ssd: <font color=''green''>Local
        SSD Cloud Disk</font>]'
      zh-cn: '<font color=''blue''><b>可选值：</b></font><br>[cloud_efficiency: <font
        color=''green''>高效云盘</font>]<br>[cloud_ssd: <font color=''green''>SSD云盘</font>]<br>[cloud_essd:
        <font color=''green''>ESSD云盘</font>]<br>[cloud: <font color=''green''>普通云盘</font>]<br>[ephemeral_ssd:
        <font color=''green''>本地SSD盘</font>]'
    Default: cloud_efficiency
    AllowedValues:
    - cloud_efficiency
    - cloud_ssd
    - cloud
    - cloud_essd
    - ephemeral_ssd
  K8sWorkerSystemDiskSize:
    Type: Number
    Label:
      en: System Disk Space
      zh-cn: 系统盘空间
    Description:
      en: System disk space of worker node
      zh-cn: Worker 节点系统盘空间
    Default: 120
    MinValue: 40
    MaxValue: 2048
Resources:
  CsManagedKubernetesCluster:
    Type: ALIYUN::CS::ManagedKubernetesCluster
    Properties:
      VpcId:
        Ref: VpcId
      VSwitchIds:
        Fn::Split:
        - ','
        - Ref: VSwitchIds
      SecurityGroupId:
        Ref: SecurityGroupId
      Addons:
      - Name: flannel
      CloudMonitorFlags: true
      ContainerCidr:
        Ref: K8sContainerCidr
      DisableRollback: false
      EndpointPublicAccess: true
      KubernetesVersion:
        Ref: K8sVersion
      LoginPassword:
        Ref: InstancePassword
      Name:
        Fn::Join:
        - ''
        - - Spring-Cloud-
          - Ref: ALIYUN::StackId
      NumOfNodes:
        Fn::Length:
          Fn::Split:
          - ','
          - Ref: VSwitchIds
      ServiceCidr:
        Ref: K8sServiceCidr
      SnatEntry: true
      WorkerInstanceTypes:
        Fn::If:
        - NoStandbyK8s
        - - Ref: K8sInstanceType
        - Fn::ListMerge:
          - - Ref: K8sInstanceType
          - Fn::Split:
            - ','
            - Ref: StandbyK8sInstanceTypes
      WorkerSystemDiskCategory:
        Ref: K8sDiskCategory
      WorkerSystemDiskSize:
        Ref: K8sWorkerSystemDiskSize
    Metadata:
      ALIYUN::ROS::Designer:
        id: d0ce96a7-4d41-452a-8ddb-6b02466440ec
  SlbLoadBalancerApiGateway:
    Type: ALIYUN::SLB::LoadBalancer
    Properties:
      VpcId:
        Ref: VpcId
      VSwitchId:
        Fn::Select:
        - 0
        - Fn::Split:
          - ','
          - Ref: VSwitchIds
      AddressType: intranet
      InternetChargeType: paybytraffic
      LoadBalancerName: SLB-ApiGateway
      LoadBalancerSpec:
        Ref: GatewaySlbSpec
    Metadata:
      ALIYUN::ROS::Designer:
        id: beed6980-655a-4e5e-9687-899d05c5d2be
  SlbListenerApiGateway:
    Type: ALIYUN::SLB::Listener
    Properties:
      BackendServerPort:
        Ref: Port
      Bandwidth: -1
      HealthCheck:
        HealthyThreshold: 3
        Interval: 2
        Port:
          Ref: Port
        Timeout: 5
        UnhealthyThreshold: 10
      ListenerPort:
        Ref: Port
      LoadBalancerId:
        Ref: SlbLoadBalancerApiGateway
      Protocol: tcp
      Scheduler: wlc
    DependsOn:
    - SlbLoadBalancerApiGateway
    Metadata:
      ALIYUN::ROS::Designer:
        id: 04956232-6aa8-4798-bb87-feab8ad316b3
  EssScalingGroupApiGateway:
    Type: ALIYUN::ESS::ScalingGroup
    Properties:
      VSwitchIds:
        Fn::Split:
        - ','
        - Ref: VSwitchIds
      DefaultCooldown: 300
      LoadBalancerIds:
      - Ref: SlbLoadBalancerApiGateway
      MaxSize: 10
      MinSize:
        Fn::Length:
          Fn::Split:
          - ','
          - Ref: VSwitchIds
      MultiAZPolicy: BALANCE
      ProtectedInstances: []
      RemovalPolicys:
      - NewestInstance
      ScalingGroupName:
        Fn::Join:
        - ''
        - - Spring-Cloud-ApiGateway-
          - Ref: ALIYUN::StackId
    DependsOn:
    - SlbListenerApiGateway
    Metadata:
      ALIYUN::ROS::Designer:
        id: 2693506f-e390-4f0e-8cf1-707b5063f98a
  RamRole:
    Type: ALIYUN::RAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
        - Action: sts:AssumeRole
          Effect: Allow
          Principal:
            Service:
            - ecs.aliyuncs.com
        Version: '1'
      Policies:
      - PolicyDocument:
          Statement:
          - Action:
            - ecs:*
            Effect: Allow
            Resource:
            - '*'
          - Action:
            - vpc:DescribeVpcs
            - vpc:DescribeVSwitches
            Effect: Allow
            Resource:
            - '*'
          - Action:
            - ess:CompleteLifecycleAction
            Effect: Allow
            Resource:
            - '*'
          - Action:
            - oos:Get*
            - oos:List*
            Effect: Allow
            Resource:
            - '*'
          - Action:
            - oss:Get*
            - oss:List*
            Effect: Allow
            Resource:
            - '*'
          - Action:
            - kms:Get*
            - kms:List*
            Effect: Allow
            Resource:
            - '*'
          Version: '1'
        PolicyName:
          Fn::Join:
          - ''
          - - Spring-Cloud-
            - Ref: ALIYUN::StackId
      RoleName:
        Fn::Join:
        - ''
        - - Spring-Cloud-
          - Ref: ALIYUN::StackId
    Metadata:
      ALIYUN::ROS::Designer:
        id: 7e6f4cbc-e3ac-4590-b445-90dede3aea08
  EssScalingGroupConfigurationApiGateway:
    Type: ALIYUN::ESS::ScalingConfiguration
    Properties:
      SecurityGroupId:
        Ref: SecurityGroupId
      ImageId:
        Ref: InstanceImageId
      InstanceName:
        Fn::Join:
        - ''
        - - Gateway-
          - Ref: ALIYUN::StackId
      InstanceTypes:
        Fn::If:
        - NoStandbyGateway
        - - Ref: GatewayInstanceType
        - Fn::ListMerge:
          - - Ref: GatewayInstanceType
          - Fn::Split:
            - ','
            - Ref: StandbyGatewayInstanceTypes
      InternetMaxBandwidthOut: 100
      IoOptimized: optimized
      RamRoleName:
        Ref: RamRole
      ScalingConfigurationName:
        Fn::Join:
        - ''
        - - Spring-Cloud-ApiGateway-
          - Ref: ALIYUN::StackId
      ScalingGroupId:
        Ref: EssScalingGroupApiGateway
      SystemDiskCategory:
        Ref: GatewayDiskCategory
      SystemDiskSize:
        Ref: GatewaySystemDiskSize
      UserData:
        Fn::Join:
        - ''
        - - "#!/bin/bash \n"
          - " \n"
          - INSTANCE_PASSWORD=
          - Ref: InstancePassword
          - '

            '
          - "echo root:${INSTANCE_PASSWORD} | chpasswd \n"
          - "sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' \"\
            /etc/ssh/sshd_config\" \n"
          - "service sshd restart \n"
          - "yum update -y \n"
          - "yum install -y java-1.8.0-openjdk jq \n"
          - "mkdir /opt/spring_cloud \n"
          - "mkdir /var/log/spring_cloud \n"
          - " \n"
          - "wget https://aliyuncli.alicdn.com/aliyun-cli-linux-3.0.65-amd64.tgz \n"
          - "tar xzvf aliyun-cli-linux-3.0.65-amd64.tgz \n"
          - "sudo cp aliyun /usr/local/bin \n"
          - ROLE_NAME=
          - Fn::GetAtt:
            - RamRole
            - RoleName
          - " \n"
          - REGION_ID=
          - Ref: ALIYUN::Region
          - " \n"
          - "/usr/local/bin/aliyun configure set --profile ecsRamRoleProfile --mode\
            \ EcsRamRole --ram-role-name ${ROLE_NAME} --region ${REGION_ID} \n"
          - "mkdir -p /root/.aliyun \n"
          - 'cat>/root/.aliyun/config.json <<EOF

            '
          - "{ \n"
          - "        \"current\": \"ecsRamRoleProfile\", \n"
          - "        \"profiles\": [ \n"
          - "                { \n"
          - "                        \"name\": \"default\", \n"
          - "                        \"mode\": \"AK\", \n"
          - "                        \"access_key_id\": \"\", \n"
          - "                        \"access_key_secret\": \"\", \n"
          - "                        \"sts_token\": \"\", \n"
          - "                        \"ram_role_name\": \"\", \n"
          - "                        \"ram_role_arn\": \"\", \n"
          - "                        \"ram_session_name\": \"\", \n"
          - "                        \"private_key\": \"\", \n"
          - "                        \"key_pair_name\": \"\", \n"
          - "                        \"expired_seconds\": 0, \n"
          - "                        \"verified\": \"\", \n"
          - "                        \"region_id\": \"\", \n"
          - "                        \"output_format\": \"json\", \n"
          - "                        \"language\": \"en\", \n"
          - "                        \"site\": \"\", \n"
          - "                        \"retry_timeout\": 0, \n"
          - "                        \"connect_timeout\": 0, \n"
          - "                        \"retry_count\": 0, \n"
          - "                        \"process_command\": \"\" \n"
          - "                }, \n"
          - "                { \n"
          - "                        \"name\": \"ecsRamRoleProfile\", \n"
          - "                        \"mode\": \"EcsRamRole\", \n"
          - "                        \"access_key_id\": \"\", \n"
          - "                        \"access_key_secret\": \"\", \n"
          - "                        \"sts_token\": \"\", \n"
          - "                        \"ram_role_name\": \"${ROLE_NAME}\", \n"
          - "                        \"ram_role_arn\": \"\", \n"
          - "                        \"ram_session_name\": \"\", \n"
          - "                        \"private_key\": \"\", \n"
          - "                        \"key_pair_name\": \"\", \n"
          - "                        \"expired_seconds\": 0, \n"
          - "                        \"verified\": \"\", \n"
          - "                        \"region_id\": \"${REGION_ID}\", \n"
          - "                        \"output_format\": \"json\", \n"
          - "                        \"language\": \"en\", \n"
          - "                        \"site\": \"china\", \n"
          - "                        \"retry_timeout\": 0, \n"
          - "                        \"connect_timeout\": 0, \n"
          - "                        \"retry_count\": 0, \n"
          - "                        \"process_command\": \"\" \n"
          - "                } \n"
          - "        ], \n"
          - "        \"meta_path\": \"\" \n"
          - "} \n"
          - 'EOF

            '
          - export eureka_server_port=
          - Ref: Port
          - " \n"
          - eureka_slb_ips=(
          - Fn::Join:
            - ' '
            - Fn::GetAtt:
              - VpcEIPsEurekaSlb
              - EipAddress
          - ") \n"
          - "count=0 \n"
          - "for ip in ${eureka_slb_ips[@]};do \n"
          - "    export \"eureka_server_${count}=${ip}\" \n"
          - "    let count+=1 \n"
          - "done \n"
    DependsOn:
    - EssScalingGroupApiGateway
    - RamRole
    Metadata:
      ALIYUN::ROS::Designer:
        id: 9866eda3-9169-433c-a862-4278b3a4ffc5
  SlbLoadBalancersEureka:
    Type: ALIYUN::SLB::LoadBalancer
    Properties:
      VpcId:
        Ref: VpcId
      VSwitchId:
        Fn::Select:
        - Ref: ALIYUN::Index
        - Fn::Split:
          - ','
          - Ref: VSwitchIds
      AddressType: intranet
      InternetChargeType: paybytraffic
      LoadBalancerName:
        Fn::Join:
        - ''
        - - SLB-Eureka-
          - Ref: ALIYUN::Index
      LoadBalancerSpec:
        Ref: EurekaSlbSpec
    Metadata:
      ALIYUN::ROS::Designer:
        id: a356b2ce-b942-4737-950b-3a6e023e3648
    Count:
      Fn::Length:
        Fn::Split:
        - ','
        - Ref: VSwitchIds
  SlbListenersEureka:
    Type: ALIYUN::SLB::Listener
    Properties:
      BackendServerPort:
        Ref: Port
      Bandwidth: -1
      HealthCheck:
        HealthyThreshold: 3
        Interval: 2
        Port:
          Ref: Port
        Timeout: 5
        UnhealthyThreshold: 10
      ListenerPort:
        Ref: Port
      LoadBalancerId:
        Fn::Select:
        - Ref: ALIYUN::Index
        - Ref: SlbLoadBalancersEureka
      Protocol: tcp
      Scheduler: wlc
    DependsOn:
    - SlbLoadBalancersEureka
    Metadata:
      ALIYUN::ROS::Designer:
        id: 4d490768-e145-4e3b-8129-6ffee65d2ffd
    Count:
      Fn::Length:
        Fn::Split:
        - ','
        - Ref: VSwitchIds
  EssScalingGroupEureka:
    Type: ALIYUN::ESS::ScalingGroup
    Properties:
      VSwitchIds:
        Fn::Split:
        - ','
        - Ref: VSwitchIds
      DefaultCooldown: 300
      LoadBalancerIds:
        Ref: SlbLoadBalancersEureka
      MaxSize: 12
      MinSize:
        Fn::Length:
          Fn::Split:
          - ','
          - Ref: VSwitchIds
      MultiAZPolicy: BALANCE
      ProtectedInstances: []
      RemovalPolicys:
      - NewestInstance
      ScalingGroupName:
        Fn::Join:
        - ''
        - - Spring-Cloud-Eureka-
          - Ref: ALIYUN::StackId
    DependsOn:
    - SlbListenersEureka
    Metadata:
      ALIYUN::ROS::Designer:
        id: 58da9547-bfde-40fb-8edf-4db0ffc99061
  EssScalingGroupConfigurationEureka:
    Type: ALIYUN::ESS::ScalingConfiguration
    Properties:
      SecurityGroupId:
        Ref: SecurityGroupId
      ImageId:
        Ref: InstanceImageId
      InstanceName:
        Fn::Join:
        - ''
        - - Eureka-
          - Ref: ALIYUN::StackId
      InstanceTypes:
        Fn::If:
        - NoStandbyEureka
        - - Ref: EurekaInstanceType
        - Fn::ListMerge:
          - - Ref: EurekaInstanceType
          - Fn::Split:
            - ','
            - Ref: StandbyEurekaInstanceTypes
      InternetMaxBandwidthOut: 100
      IoOptimized: optimized
      RamRoleName:
        Ref: RamRole
      ScalingGroupId:
        Ref: EssScalingGroupEureka
      SystemDiskCategory:
        Ref: EurekaDiskCategory
      SystemDiskSize:
        Ref: EurekaSystemDiskSize
      UserData:
        Fn::Join:
        - ''
        - - "#!/bin/bash \n"
          - " \n"
          - INSTANCE_PASSWORD=
          - Ref: InstancePassword
          - '

            '
          - "echo root:${INSTANCE_PASSWORD} | chpasswd \n"
          - "sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' \"\
            /etc/ssh/sshd_config\" \n"
          - "service sshd restart \n"
          - "yum update -y \n"
          - "yum install -y java-1.8.0-openjdk jq \n"
          - "mkdir /opt/spring_cloud \n"
          - "mkdir /var/log/spring_cloud \n"
          - " \n"
          - "wget https://aliyuncli.alicdn.com/aliyun-cli-linux-3.0.65-amd64.tgz \n"
          - "tar xzvf aliyun-cli-linux-3.0.65-amd64.tgz \n"
          - "sudo cp aliyun /usr/local/bin \n"
          - ROLE_NAME=
          - Fn::GetAtt:
            - RamRole
            - RoleName
          - " \n"
          - REGION_ID=
          - Ref: ALIYUN::Region
          - " \n"
          - "/usr/local/bin/aliyun configure set --profile ecsRamRoleProfile --mode\
            \ EcsRamRole --ram-role-name ${ROLE_NAME} --region ${REGION_ID} \n"
          - "mkdir -p /root/.aliyun \n"
          - 'cat>/root/.aliyun/config.json <<EOF

            '
          - "{ \n"
          - "        \"current\": \"ecsRamRoleProfile\", \n"
          - "        \"profiles\": [ \n"
          - "                { \n"
          - "                        \"name\": \"default\", \n"
          - "                        \"mode\": \"AK\", \n"
          - "                        \"access_key_id\": \"\", \n"
          - "                        \"access_key_secret\": \"\", \n"
          - "                        \"sts_token\": \"\", \n"
          - "                        \"ram_role_name\": \"\", \n"
          - "                        \"ram_role_arn\": \"\", \n"
          - "                        \"ram_session_name\": \"\", \n"
          - "                        \"private_key\": \"\", \n"
          - "                        \"key_pair_name\": \"\", \n"
          - "                        \"expired_seconds\": 0, \n"
          - "                        \"verified\": \"\", \n"
          - "                        \"region_id\": \"\", \n"
          - "                        \"output_format\": \"json\", \n"
          - "                        \"language\": \"en\", \n"
          - "                        \"site\": \"\", \n"
          - "                        \"retry_timeout\": 0, \n"
          - "                        \"connect_timeout\": 0, \n"
          - "                        \"retry_count\": 0, \n"
          - "                        \"process_command\": \"\" \n"
          - "                }, \n"
          - "                { \n"
          - "                        \"name\": \"ecsRamRoleProfile\", \n"
          - "                        \"mode\": \"EcsRamRole\", \n"
          - "                        \"access_key_id\": \"\", \n"
          - "                        \"access_key_secret\": \"\", \n"
          - "                        \"sts_token\": \"\", \n"
          - "                        \"ram_role_name\": \"${ROLE_NAME}\", \n"
          - "                        \"ram_role_arn\": \"\", \n"
          - "                        \"ram_session_name\": \"\", \n"
          - "                        \"private_key\": \"\", \n"
          - "                        \"key_pair_name\": \"\", \n"
          - "                        \"expired_seconds\": 0, \n"
          - "                        \"verified\": \"\", \n"
          - "                        \"region_id\": \"${REGION_ID}\", \n"
          - "                        \"output_format\": \"json\", \n"
          - "                        \"language\": \"en\", \n"
          - "                        \"site\": \"china\", \n"
          - "                        \"retry_timeout\": 0, \n"
          - "                        \"connect_timeout\": 0, \n"
          - "                        \"retry_count\": 0, \n"
          - "                        \"process_command\": \"\" \n"
          - "                } \n"
          - "        ], \n"
          - "        \"meta_path\": \"\" \n"
          - "} \n"
          - 'EOF

            '
          - export eureka_server_port=
          - Ref: Port
          - " \n"
          - eureka_slb_ips=(
          - Fn::Join:
            - ' '
            - Fn::GetAtt:
              - VpcEIPsEurekaSlb
              - EipAddress
          - ") \n"
          - "count=0 \n"
          - "for ip in ${eureka_slb_ips[@]};do \n"
          - "    export \"eureka_server_${count}=${ip}\" \n"
          - "    let count+=1 \n"
          - "done \n"
    DependsOn:
    - EssScalingGroupEureka
    - RamRole
    Metadata:
      ALIYUN::ROS::Designer:
        id: 35d23969-5933-4241-934e-d0926d2359ba
  EssScalingGroupEnable:
    Type: ALIYUN::ESS::ScalingGroupEnable
    Properties:
      ScalingConfigurationId:
        Ref: EssScalingGroupConfigurationEureka
      ScalingGroupId:
        Ref: EssScalingGroupEureka
    DependsOn:
    - EssScalingGroupConfigurationEureka
    Metadata:
      ALIYUN::ROS::Designer:
        id: c27aecbc-af58-4789-ae88-96fb3e606b21
  EssScalingGroupEnableApiGateway:
    Type: ALIYUN::ESS::ScalingGroupEnable
    Properties:
      ScalingConfigurationId:
        Ref: EssScalingGroupConfigurationApiGateway
      ScalingGroupId:
        Ref: EssScalingGroupApiGateway
    DependsOn:
    - EssScalingGroupConfigurationApiGateway
    Metadata:
      ALIYUN::ROS::Designer:
        id: a89a2ffa-6a62-4d45-99aa-accf0a428dde
  OosParameterEurekaUrlPort:
    Type: ALIYUN::OOS::Parameter
    Properties:
      Name:
        Fn::Join:
        - ''
        - - /Spring/Eureka/
          - Ref: ALIYUN::StackId
          - /port
      Type: String
      Value:
        Fn::Str:
          Ref: Port
    Metadata:
      ALIYUN::ROS::Designer:
        id: 9f0c5224-0ee8-4a5d-b183-d11b5aebf14e
  VpcEIPsEurekaSlb:
    Type: ALIYUN::VPC::EIP
    Properties:
      Bandwidth: 5
      InternetChargeType: PayByTraffic
      Name:
        Fn::Join:
        - ''
        - - EIP-SLB-Eureka-
          - Ref: ALIYUN::Index
    Metadata:
      ALIYUN::ROS::Designer:
        id: d388ddb5-98ad-4e35-96db-962d547feae1
    Count:
      Fn::Length:
        Fn::Split:
        - ','
        - Ref: VSwitchIds
  VpcEIPsAssociation:
    Type: ALIYUN::VPC::EIPAssociation
    Properties:
      InstanceId:
        Fn::Select:
        - Ref: ALIYUN::Index
        - Ref: SlbLoadBalancersEureka
      AllocationId:
        Fn::Select:
        - Ref: ALIYUN::Index
        - Ref: VpcEIPsEurekaSlb
    DependsOn:
    - SlbLoadBalancersEureka
    - VpcEIPsEurekaSlb
    Metadata:
      ALIYUN::ROS::Designer:
        id: a8bbdd46-bd2f-40f1-9252-38cad458c326
    Count:
      Fn::Length:
        Fn::Split:
        - ','
        - Ref: VSwitchIds
  OosParameterEurekaUrls:
    Type: ALIYUN::OOS::Parameter
    Properties:
      Name:
        Fn::Join:
        - ''
        - - /Spring/Eureka/
          - Ref: ALIYUN::StackId
          - /URL_
          - Ref: ALIYUN::Index
          - /
      Type: String
      Value:
        Fn::Select:
        - Ref: ALIYUN::Index
        - Fn::GetAtt:
          - VpcEIPsEurekaSlb
          - EipAddress
    DependsOn:
    - VpcEIPsAssociation
    Metadata:
      ALIYUN::ROS::Designer:
        id: 2290dd07-f78b-4063-9a41-c1112929b562
    Count:
      Fn::Length:
        Fn::Split:
        - ','
        - Ref: VSwitchIds
  VpcEipApiGatewaySlb:
    Type: ALIYUN::VPC::EIP
    Properties:
      Bandwidth: 5
      InternetChargeType: PayByTraffic
      Name: ApiGateway-SLB-1
    Metadata:
      ALIYUN::ROS::Designer:
        id: 841bb403-06e9-46ec-982b-f3f16b26e420
  VpcEipAssociationApiGateway:
    Type: ALIYUN::VPC::EIPAssociation
    Properties:
      InstanceId:
        Ref: SlbLoadBalancerApiGateway
      AllocationId:
        Ref: VpcEipApiGatewaySlb
    DependsOn:
    - SlbLoadBalancerApiGateway
    - VpcEipApiGatewaySlb
    Metadata:
      ALIYUN::ROS::Designer:
        id: 9109f4ce-591e-4a88-a53e-a950e67b1dd0
Outputs:
  ApiGatewayUrl:
    Value:
      Fn::Join:
      - ''
      - - http://
        - Fn::GetAtt:
          - VpcEipApiGatewaySlb
          - EipAddress
        - ':'
        - Ref: Port
        - /
  CSClusterId:
    Value:
      Fn::GetAtt:
      - CsManagedKubernetesCluster
      - ClusterId
  EurekaUrlList:
    Value:
      Fn::Split:
      - ','
      - Fn::Join:
        - ''
        - - http://
          - Fn::Join:
            - Fn::Join:
              - ''
              - - ':'
                - Ref: Port
                - /, http://
            - Fn::GetAtt:
              - VpcEIPsEurekaSlb
              - EipAddress
          - ':'
          - Ref: Port
          - /
  OosParameterEurekaPort:
    Value:
      Fn::GetAtt:
      - OosParameterEurekaUrlPort
      - Name
  OosParameterEurekaUrls:
    Value:
      Fn::GetAtt:
      - OosParameterEurekaUrls
      - Name
Metadata:
  ALIYUN::ROS::Interface:
    ParameterGroups:
    - Parameters:
      - VpcId
      - SecurityGroupId
      - VSwitchIds
      - Port
      - InstanceImageId
      - InstancePassword
      Label:
        default:
          en: Base Information Configuration
          zh-cn: 基础信息配置（必填）
    - Parameters:
      - EurekaSlbSpec
      - EurekaInstanceType
      - StandbyEurekaInstanceTypes
      - EurekaDiskCategory
      - EurekaSystemDiskSize
      Label:
        default:
          en: Eureka Configuration
          zh-cn: Eureka配置（必填）
    - Parameters:
      - GatewaySlbSpec
      - GatewayInstanceType
      - StandbyGatewayInstanceTypes
      - GatewayDiskCategory
      - GatewaySystemDiskSize
      Label:
        default:
          en: Gateway Configuration
          zh-cn: Gateway配置（必填）
    - Parameters:
      - K8sVersion
      - K8sInstanceType
      - StandbyK8sInstanceTypes
      - K8sContainerCidr
      - K8sServiceCidr
      - K8sDiskCategory
      - K8sWorkerSystemDiskSize
      Label:
        default:
          en: Managed Kubernetes Cluster Configuration
          zh-cn: Kubernetes托管版集群配置（必填）
    TemplateTags:
    - acs:solution:容器&微服务:SpringCloud-云原生迁移
  ALIYUN::ROS::Designer:
    0005e176-f211-4b06-b994-8e3da8581c61:
      source:
        id: c27aecbc-af58-4789-ae88-96fb3e606b21
      target:
        id: 35d23969-5933-4241-934e-d0926d2359ba
      z: 1
    0046ed22-0221-45c6-8d08-91e4884cad77:
      source:
        id: 9109f4ce-591e-4a88-a53e-a950e67b1dd0
      target:
        id: 841bb403-06e9-46ec-982b-f3f16b26e420
      z: 1
    04956232-6aa8-4798-bb87-feab8ad316b3:
      position:
        x: 907
        y: 344
      size:
        height: 60
        width: 60
      z: 0
    2290dd07-f78b-4063-9a41-c1112929b562:
      position:
        x: 108
        y: 117
      size:
        height: 60
        width: 60
      z: 0
    229fa70a-6960-4ffb-a37e-b69cf2b85c41:
      source:
        id: 35d23969-5933-4241-934e-d0926d2359ba
      target:
        id: 7e6f4cbc-e3ac-4590-b445-90dede3aea08
      z: 1
    2693506f-e390-4f0e-8cf1-707b5063f98a:
      position:
        x: 733
        y: 224
      size:
        height: 60
        width: 60
      z: 0
    35d23969-5933-4241-934e-d0926d2359ba:
      position:
        x: 285
        y: 224
      size:
        height: 60
        width: 60
      z: 0
    41cec604-9813-4e97-9f95-dba4ef67e971:
      source:
        id: a89a2ffa-6a62-4d45-99aa-accf0a428dde
      target:
        id: 2693506f-e390-4f0e-8cf1-707b5063f98a
      z: 1
    4d490768-e145-4e3b-8129-6ffee65d2ffd:
      position:
        x: -54
        y: 350
      size:
        height: 60
        width: 60
      z: 0
    58da9547-bfde-40fb-8edf-4db0ffc99061:
      position:
        x: 104
        y: 224
      size:
        height: 60
        width: 60
      z: 0
    5dc621be-969c-4733-a6e2-e8cb54f59dcd:
      source:
        id: 9866eda3-9169-433c-a862-4278b3a4ffc5
      target:
        id: 7e6f4cbc-e3ac-4590-b445-90dede3aea08
      z: 1
    5dc7d99d-1956-4a6a-9161-f08a575135a9:
      source:
        id: a8bbdd46-bd2f-40f1-9252-38cad458c326
      target:
        id: a356b2ce-b942-4737-950b-3a6e023e3648
      z: 1
    63de8bb1-e40b-4b17-9202-df91666418a3:
      source:
        id: a89a2ffa-6a62-4d45-99aa-accf0a428dde
      target:
        id: 9866eda3-9169-433c-a862-4278b3a4ffc5
      z: 1
    75f742e0-bb49-426e-9594-596fe02626f0:
      source:
        id: c27aecbc-af58-4789-ae88-96fb3e606b21
      target:
        id: 58da9547-bfde-40fb-8edf-4db0ffc99061
      z: 1
    78eca880-8c4a-48b5-90af-e5aff81c7aa1:
      source:
        id: 9866eda3-9169-433c-a862-4278b3a4ffc5
      target:
        id: 2693506f-e390-4f0e-8cf1-707b5063f98a
      z: 1
    7e6f4cbc-e3ac-4590-b445-90dede3aea08:
      position:
        x: 413
        y: 7
      size:
        height: 60
        width: 60
      z: 0
    841bb403-06e9-46ec-982b-f3f16b26e420:
      position:
        x: 1063
        y: 227
      size:
        height: 60
        width: 60
      z: 0
    9109f4ce-591e-4a88-a53e-a950e67b1dd0:
      position:
        x: 985
        y: 117
      size:
        height: 60
        width: 60
      z: 0
    9866eda3-9169-433c-a862-4278b3a4ffc5:
      position:
        x: 526
        y: 224
      size:
        height: 60
        width: 60
      z: 0
    9f0c5224-0ee8-4a5d-b183-d11b5aebf14e:
      position:
        x: 192
        y: 451
      size:
        height: 60
        width: 60
      z: 0
    a356b2ce-b942-4737-950b-3a6e023e3648:
      position:
        x: -54
        y: 224
      size:
        height: 60
        width: 60
      z: 0
    a401825a-6dbf-4c4c-a8ef-b22a7078ef25:
      source:
        id: 04956232-6aa8-4798-bb87-feab8ad316b3
      target:
        id: beed6980-655a-4e5e-9687-899d05c5d2be
      z: 1
    a5131b75-ae51-40ae-b112-7ed11090613e:
      source:
        id: 2290dd07-f78b-4063-9a41-c1112929b562
      target:
        id: a8bbdd46-bd2f-40f1-9252-38cad458c326
      z: 1
    a6db585a-4532-45af-bd12-919a3954dd86:
      source:
        id: 58da9547-bfde-40fb-8edf-4db0ffc99061
      target:
        id: a356b2ce-b942-4737-950b-3a6e023e3648
      z: 1
    a89a2ffa-6a62-4d45-99aa-accf0a428dde:
      position:
        x: 630
        y: 341
      size:
        height: 60
        width: 60
      z: 0
    a8bbdd46-bd2f-40f1-9252-38cad458c326:
      position:
        x: -121
        y: 117
      size:
        height: 60
        width: 60
      z: 0
    bb7c6aa9-5fad-4d71-89cb-2cd11ba2fbdd:
      source:
        id: 9109f4ce-591e-4a88-a53e-a950e67b1dd0
      target:
        id: beed6980-655a-4e5e-9687-899d05c5d2be
      z: 1
    beed6980-655a-4e5e-9687-899d05c5d2be:
      position:
        x: 907
        y: 227
      size:
        height: 60
        width: 60
      z: 0
    c27aecbc-af58-4789-ae88-96fb3e606b21:
      position:
        x: 191
        y: 348
      size:
        height: 60
        width: 60
      z: 0
    d0ce96a7-4d41-452a-8ddb-6b02466440ec:
      position:
        x: 415
        y: 448
      size:
        height: 60
        width: 60
      z: 0
    d388ddb5-98ad-4e35-96db-962d547feae1:
      position:
        x: -190
        y: 224
      size:
        height: 60
        width: 60
      z: 0
    d4460b5a-5273-41cf-ad4c-454108571a6a:
      source:
        id: 35d23969-5933-4241-934e-d0926d2359ba
      target:
        id: 58da9547-bfde-40fb-8edf-4db0ffc99061
      z: 1
    e4c6f376-adb7-4ec9-9bbd-d6ca4667b4ef:
      source:
        id: 4d490768-e145-4e3b-8129-6ffee65d2ffd
      target:
        id: a356b2ce-b942-4737-950b-3a6e023e3648
      z: 1
    eb5c4594-58a2-4898-904a-8d8db051d8be:
      source:
        id: a8bbdd46-bd2f-40f1-9252-38cad458c326
      target:
        id: d388ddb5-98ad-4e35-96db-962d547feae1
      z: 1
